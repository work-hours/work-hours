import{c as ae,r as v,u as ie,j as e,H as re}from"./app-Bk4PR63W.js";import{t as q}from"./index-D-Gk-yT4.js";import{B as ne}from"./back-button-ya3in1Ao.js";import{I as m}from"./input-error-aCAuibxh.js";import{S as le}from"./submit-button-D4bxzCEW.js";import{B as V}from"./button-BGAiRGZg.js";import{C as y,a as N,b,c as L,d as S,e as de}from"./card-Dtas3RKB.js";import{D as O,C as R}from"./react-datepicker-CNrS-JzU.js";import{L as p,I as h}from"./label-HoiQ3GNm.js";import{S as I,a as C,b as w,c as F,d as u}from"./select-BTxuEGZI.js";import{S as z}from"./separator-BW-T-K39.js";import{T as oe,a as ce,b as me,c as _,d as ue,e as xe,f}from"./table-B_Bh9XXk.js";import{T as pe}from"./textarea-hH4xkfAo.js";import{M as he}from"./master-layout-DChFziky.js";import{H as ge,c as je}from"./ClientController-DG5t_2Uz.js";import{i as _e}from"./InvoiceController-onzgdswi.js";import{F as fe}from"./file-text-BEAzekmp.js";import{U as ve}from"./user-C4MlcwvE.js";import{C as Q}from"./calendar-CgkFkY-D.js";import{P as ye}from"./plus-p8BKPWNs.js";import{T as Ne}from"./trash-2-C7f2dPei.js";import{L as be}from"./loader-circle-BCYeDwOj.js";import{S as Se}from"./save-9NB0FlW1.js";/* empty css            */import"./index-D-w6wlEG.js";import"./utils-DKW5XViW.js";import"./arrow-left-2sSyqyTB.js";import"./createLucideIcon-CdLL0xzd.js";import"./index-DDqfYr5D.js";import"./floating-ui.react-dom-8ikc8Qbx.js";import"./index-BsY2LpXN.js";import"./index-Dely6azp.js";import"./index-C79L9l-a.js";import"./index-DiDFMmY4.js";import"./index-BJl2vPHw.js";import"./index-CPvS59-d.js";import"./chevron-up-F-D43jrY.js";import"./cookie-consent-4J8V3XdM.js";import"./index-D5x193o-.js";import"./TaskController-DRILXs0Z.js";import"./jira-icon-wsasIrn-.js";import"./x-Dz3a5Yj_.js";import"./index-DDNv-7cB.js";import"./sheet-D7dB8w4W.js";import"./clock-oQTHBRij.js";import"./appearance-dropdown-mVcvt_IG.js";import"./dropdown-menu-DdvMI060.js";import"./index-B_GyHV6l.js";import"./circle-alert-BqzIHG1p.js";import"./checkbox-DLdSU6vz.js";import"./badge-BNr9aysp.js";import"./chevron-right-BUIh066M.js";import"./settings-DsZ09whw.js";import"./bell-CQjVsOHt.js";import"./users-DZUcVCZB.js";import"./app-logo-icon-CFfAIG7o.js";import"./github-DB_zkOOK.js";import"./log-out-CHwRCYXF.js";import"./building-b-lKGHwq.js";import"./projector-DmVTEmlk.js";import"./clipboard-list-CMM2SLJn.js";import"./timer-CKwyTId6.js";import"./square-check-big-BqCCrkHI.js";function Lt({invoice:l}){const{auth:$}=ae().props,[W,J]=v.useState([]),[g,K]=v.useState([]),[k,A]=v.useState(!0),X=[{title:"Invoices",href:"/invoice"},{title:`Edit ${l.invoice_number}`,href:`/invoice/${l.id}/edit`}],P=t=>new Date(t),Y=t=>t.map(a=>({id:a.id,time_log_id:a.time_log_id?a.time_log_id.toString():null,description:a.description,quantity:a.quantity.toString(),unit_price:a.unit_price.toString(),amount:a.amount.toString()})),{data:s,setData:r,put:Z,processing:n,errors:c,transform:U}=ie({client_id:l.client_id.toString(),invoice_number:l.invoice_number,issue_date:P(l.issue_date),due_date:P(l.due_date),status:l.status,paid_amount:l.paid_amount.toString(),notes:l.notes||"",discount_type:l.discount_type,discount_value:l.discount_value?l.discount_value.toString():"0",tax_type:l.tax_type,tax_rate:l.tax_rate?l.tax_rate.toString():"0",currency:l.currency,items:Y(l.items),grouped_time_log_ids:[]});v.useEffect(()=>{(async()=>{try{A(!0);const a=await je.data({});J(a)}catch(a){console.error("Error fetching clients:",a),q.error("Failed to load clients")}finally{A(!1)}})()},[]),v.useEffect(()=>{(async()=>{var a;if(s.client_id)try{const i=await _e.data({action:"getUnpaidTimeLogs",params:{client_id:s.client_id}});if(K(i),i.length>0){const d=(a=i[0])==null?void 0:a.currency;d?r("currency",d):$.user.currency?r("currency",$.user.currency?$.user.currency.toString():"USD"):r("currency","USD")}}catch(i){console.error("Error fetching time logs:",i),q.error("Failed to load time logs")}})()},[s.client_id]);const T=()=>s.items.reduce((t,a)=>t+parseFloat(a.amount||"0"),0),B=()=>{const t=T();if(!s.discount_type||parseFloat(s.discount_value)<=0)return 0;if(s.discount_type==="percentage")return t*parseFloat(s.discount_value)/100;if(s.discount_type==="fixed"){const a=parseFloat(s.discount_value);return a>t?t:a}return 0},H=()=>{const t=T();if(!s.tax_type||parseFloat(s.tax_rate)<=0)return 0;if(s.tax_type==="percentage")return t*parseFloat(s.tax_rate)/100;if(s.tax_type==="fixed"){const a=parseFloat(s.tax_rate);return a>t?t:a}return 0},M=()=>{const t=T(),a=B(),i=H();return t-a+i},G=()=>{r("items",[...s.items,{time_log_id:null,description:"",quantity:"1",unit_price:"0",amount:"0"}])},ee=t=>{const a=[...s.items];a.splice(t,1),r("items",a)},D=(t,a,i)=>{const d=[...s.items];if(d[t]={...d[t],[a]:i},a==="quantity"||a==="unit_price"){const o=parseFloat(a==="quantity"?i:d[t].quantity||"0"),x=parseFloat(a==="unit_price"?i:d[t].unit_price||"0");d[t].amount=(o*x).toFixed(2)}r("items",d)},te=(t,a)=>{const i=[...s.items];if(a==="none"){i[t]={...i[t],time_log_id:null,description:"",quantity:"1",unit_price:"0",amount:"0"},r("items",i);return}if(a.startsWith("project-")){const o=parseInt(a.replace("project-","")),x=g.find(j=>j.project_id===o);if(x){const j=((x.total_hours||0)*(x.hourly_rate||0)).toFixed(2);i[t]={...i[t],time_log_id:null,description:`Time logged for ${x.project_name}`,quantity:x.total_hours.toString(),unit_price:x.hourly_rate.toString(),amount:j,group_project_id:o},r("items",i)}return}const d=a;i[t].group_project_id=void 0;for(const o of g){const x=o.time_logs.find(j=>j.id.toString()===d);if(x){const j=((x.duration||0)*(o.hourly_rate||0)).toFixed(2);i[t]={...i[t],time_log_id:d,description:`Time logged for ${o.project_name}`,quantity:x.duration.toString(),unit_price:o.hourly_rate.toString(),amount:j},r("items",i);break}}},se=t=>{t.preventDefault();const a=new Set;s.items.forEach(i=>{if(i.group_project_id){const d=g.find(o=>o.project_id===i.group_project_id);d&&d.time_logs&&d.time_logs.forEach(o=>a.add(o.id))}}),U(i=>({...i,grouped_time_log_ids:Array.from(a)})),Z(route("invoice.update",l.id),{onSuccess:()=>{q.success("Invoice updated successfully")},onError:()=>{q.error("Failed to update invoice")},onFinish:()=>{U(i=>i)}})},E=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:s.currency||"USD",currencyDisplay:"code"}).format(t);return e.jsxs(he,{breadcrumbs:X,children:[e.jsx(re,{title:`Edit Invoice - ${l.invoice_number}`}),e.jsxs("div",{className:"mx-auto flex flex-col gap-6 p-3",children:[e.jsxs("section",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-100",children:"Edit Invoice"}),e.jsxs("p",{className:"mt-1 text-gray-500 dark:text-gray-400",children:["Update invoice ",l.invoice_number]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(ne,{disabled:n})})]}),e.jsxs("form",{className:"flex flex-col gap-6",onSubmit:se,children:[e.jsxs("h2",{className:"mt-2 flex items-center gap-2 border-b pb-2 text-xl font-semibold",children:[e.jsx(fe,{className:"h-5 w-5"}),"Invoice Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs(y,{className:"transition-all hover:shadow-md",children:[e.jsxs(N,{children:[e.jsx(b,{className:"flex items-center gap-2 text-lg",children:"Basic Information"}),e.jsx(L,{children:"Update the core details for this invoice"})]}),e.jsx(S,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(p,{htmlFor:"client_id",className:"flex items-center gap-1 text-sm font-medium",children:["Client ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsxs(I,{value:s.client_id,onValueChange:t=>r("client_id",t),disabled:n||k,children:[e.jsx(C,{id:"client_id",className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:k?"Loading clients...":"Select a client"})]})}),e.jsx(F,{children:W.map(t=>e.jsx(u,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(m,{message:c.client_id,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsxs(p,{htmlFor:"invoice_number",className:"flex items-center gap-1 text-sm font-medium",children:["Invoice Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center",children:e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(h,{id:"invoice_number",type:"text",required:!0,value:s.invoice_number,onChange:t=>r("invoice_number",t.target.value),disabled:n,placeholder:"Invoice number",className:"pl-10"})]}),e.jsx(m,{message:c.invoice_number,className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(p,{htmlFor:"issue_date",className:"flex items-center gap-1 text-sm font-medium",children:["Issue Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(O,{selected:s.issue_date,onChange:t=>r("issue_date",t),dateFormat:"yyyy-MM-dd",disabled:n,customInput:e.jsx(R,{id:"issue_date",icon:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),placeholder:"Select issue date",value:s.issue_date?s.issue_date.toISOString().split("T")[0]:"",disabled:n})})}),e.jsx(m,{message:c.issue_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsxs(p,{htmlFor:"due_date",className:"flex items-center gap-1 text-sm font-medium",children:["Due Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(O,{selected:s.due_date,onChange:t=>r("due_date",t),dateFormat:"yyyy-MM-dd",disabled:n,customInput:e.jsx(R,{id:"due_date",icon:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),placeholder:"Select due date",value:s.due_date?s.due_date.toISOString().split("T")[0]:"",disabled:n})})}),e.jsx(m,{message:c.due_date,className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(p,{htmlFor:"status",className:"text-sm font-medium",children:["Status ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsxs(I,{value:s.status,onValueChange:t=>{r("status",t),t==="paid"&&r("paid_amount",M().toFixed(2))},children:[e.jsx(C,{id:"status",className:"w-full",children:e.jsx(w,{placeholder:"Select status"})}),e.jsxs(F,{children:[e.jsx(u,{value:"draft",children:"Draft"}),e.jsx(u,{value:"sent",children:"Sent"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"partially_paid",children:"Partially Paid"}),e.jsx(u,{value:"overdue",children:"Overdue"}),e.jsx(u,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(m,{message:c.status,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"paid_amount",className:"flex items-center gap-1 text-sm font-medium",children:"Paid Amount"}),e.jsx("div",{className:"relative",children:e.jsx(h,{id:"paid_amount",type:"number",min:"0",step:"0.01",value:s.paid_amount,onChange:t=>r("paid_amount",t.target.value),disabled:n||s.status!=="partially_paid"&&s.status!=="paid",placeholder:"Enter amount paid"})}),e.jsx(m,{message:c.paid_amount,className:"mt-1"})]})]})]})})]}),e.jsxs(y,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(N,{children:[e.jsx(b,{className:"flex items-center gap-2 text-lg",children:"Additional Information"}),e.jsx(L,{children:"Add notes for this invoice"})]}),e.jsx(S,{children:e.jsxs("div",{children:[e.jsxs(p,{htmlFor:"notes",className:"text-sm font-medium",children:["Notes ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsx(pe,{id:"notes",value:s.notes,onChange:t=>r("notes",t.target.value),disabled:n,placeholder:"Additional notes for the client",className:"min-h-[120px] resize-y"}),e.jsx(m,{message:c.notes,className:"mt-1"})]})})]})]}),e.jsxs(y,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-lg",children:"Invoice Items"}),e.jsx(L,{children:"Add or update the products or services you're invoicing for"})]}),e.jsxs(V,{type:"button",onClick:G,disabled:n,className:"flex items-center gap-2 bg-gray-900 text-sm hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",children:[e.jsx(ye,{className:"h-4 w-4"}),"Add Item"]})]}),e.jsx(S,{children:e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs(oe,{children:[e.jsx(ce,{className:"bg-muted/50",children:e.jsxs(me,{children:[e.jsx(_,{children:"Time Log"}),e.jsx(_,{children:"Description"}),e.jsx(_,{children:"Quantity (hrs)"}),e.jsx(_,{children:"Unit Price"}),e.jsx(_,{children:"Amount"}),e.jsx(_,{className:"w-[50px]",children:void 0})]})}),e.jsx(ue,{children:s.items.map((t,a)=>e.jsxs(xe,{className:"hover:bg-muted/30",children:[e.jsxs(f,{children:[e.jsxs(I,{value:t.time_log_id||"none",onValueChange:i=>te(a,i),disabled:n,children:[e.jsx(C,{className:"w-full",children:e.jsx(w,{placeholder:"Select time log (optional)"})}),e.jsxs(F,{children:[e.jsx(u,{value:"none",children:"None"}),g.length>0&&e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-muted-foreground",children:"Project Totals"}),g.map((i,d)=>e.jsxs(u,{value:`project-${i.project_id}`,className:"font-medium",children:[i.project_name," - ",(i.total_hours||0).toFixed(2)," hours (",i.currency||"USD"," ",i.hourly_rate||0,"/hr)"]},`project-${i.project_id||`unnamed-${d}`}`)),g.length>0&&e.jsx("div",{className:"mt-2 px-2 py-1.5 text-xs font-medium text-muted-foreground",children:"Individual Time Logs"}),g.map((i,d)=>e.jsxs("div",{children:[i.time_logs&&i.time_logs.length>0&&e.jsx("div",{className:"px-2 py-1 text-xs font-medium",children:i.project_name}),i.time_logs&&i.time_logs.map(o=>e.jsxs(u,{value:o.id.toString(),className:"pl-4",children:[new Date(o.start_timestamp).toISOString().split("T")[0]," -"," ",(o.duration||0).toFixed(2)," hours"]},o.id))]},`logs-${i.project_id||`unnamed-${d}`}`))]})]}),e.jsx(m,{message:c[`items.${a}.time_log_id`],className:"mt-1"})]}),e.jsxs(f,{children:[e.jsx(h,{type:"text",value:t.description,onChange:i=>D(a,"description",i.target.value),disabled:n,placeholder:"Item description",required:!0}),e.jsx(m,{message:c[`items.${a}.description`],className:"mt-1"})]}),e.jsxs(f,{children:[e.jsx(h,{type:"number",min:"0.01",step:"0.01",value:t.quantity,onChange:i=>D(a,"quantity",i.target.value),disabled:n,required:!0}),e.jsx(m,{message:c[`items.${a}.quantity`],className:"mt-1"})]}),e.jsxs(f,{children:[e.jsx(h,{type:"number",min:"0",step:"0.01",value:t.unit_price,onChange:i=>D(a,"unit_price",i.target.value),disabled:n,required:!0}),e.jsx(m,{message:c[`items.${a}.unit_price`],className:"mt-1"})]}),e.jsxs(f,{children:[e.jsx(h,{type:"number",min:"0",step:"0.01",value:t.amount,onChange:i=>D(a,"amount",i.target.value),disabled:!0,required:!0,className:"bg-muted/40"}),e.jsx(m,{message:c[`items.${a}.amount`],className:"mt-1"})]}),e.jsx(f,{children:e.jsxs(V,{type:"button",variant:"ghost",size:"sm",disabled:n||s.items.length<=1,onClick:()=>ee(a),className:"h-8 w-8 bg-red-100 p-0 text-red-600 hover:bg-red-200",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Remove"})]})})]},a))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs(y,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsx(N,{children:e.jsx(b,{className:"flex items-center gap-2 text-lg",children:"Discount & Taxes"})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"discount_type",className:"text-sm font-medium",children:"Discount Type"}),e.jsxs(I,{value:s.discount_type||"none",onValueChange:t=>r("discount_type",t==="none"?null:t),disabled:n,children:[e.jsx(C,{id:"discount_type",className:"w-full",children:e.jsx(w,{placeholder:"No Discount"})}),e.jsxs(F,{children:[e.jsx(u,{value:"none",children:"No Discount"}),e.jsx(u,{value:"percentage",children:"Percentage (%)"}),e.jsx(u,{value:"fixed",children:"Fixed Amount"})]})]}),e.jsx(m,{message:c.discount_type,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"discount_value",className:"text-sm font-medium",children:s.discount_type==="percentage"?"Discount (%)":"Discount Amount"}),e.jsx(h,{id:"discount_value",type:"number",min:"0",step:s.discount_type==="percentage"?"1":"0.01",value:s.discount_value,onChange:t=>r("discount_value",t.target.value),disabled:n||!s.discount_type,placeholder:s.discount_type==="percentage"?"Enter percentage":"Enter amount"}),e.jsx(m,{message:c.discount_value,className:"mt-1"})]})]}),e.jsx(z,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"tax_type",className:"text-sm font-medium",children:"Tax Type"}),e.jsxs(I,{value:s.tax_type||"none",onValueChange:t=>r("tax_type",t==="none"?null:t),disabled:n,children:[e.jsx(C,{id:"tax_type",className:"w-full",children:e.jsx(w,{placeholder:"No Tax"})}),e.jsxs(F,{children:[e.jsx(u,{value:"none",children:"No Tax"}),e.jsx(u,{value:"percentage",children:"Percentage (%)"}),e.jsx(u,{value:"fixed",children:"Fixed Amount"})]})]}),e.jsx(m,{message:c.tax_type,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"tax_rate",className:"text-sm font-medium",children:s.tax_type==="percentage"?"Tax (%)":"Tax Amount"}),e.jsx(h,{id:"tax_rate",type:"number",min:"0",step:"0.01",value:s.tax_rate,onChange:t=>r("tax_rate",t.target.value),disabled:n||!s.tax_type,placeholder:s.tax_type==="percentage"?"Enter percentage":"Enter amount"}),e.jsx(m,{message:c.tax_rate,className:"mt-1"})]})]})]})})]}),e.jsxs(y,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsx(N,{children:e.jsx(b,{className:"text-lg",children:"Invoice Summary"})}),e.jsx(S,{children:e.jsxs("div",{className:"rounded-md border bg-muted/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:E(T())})]}),s.discount_type&&parseFloat(s.discount_value)>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-red-600 dark:text-red-400",children:[e.jsxs("span",{children:["Discount ",s.discount_type==="percentage"?`(${s.discount_value}%)`:"",":"]}),e.jsxs("span",{children:["-",E(B())]})]}),s.tax_type&&parseFloat(s.tax_rate)>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["Tax ",s.tax_type==="percentage"?`(${s.tax_rate}%)`:"",":"]}),e.jsxs("span",{children:["+",E(H())]})]}),e.jsx(z,{className:"my-3"}),e.jsxs("div",{className:"flex items-center justify-between font-medium",children:[e.jsx("span",{className:"text-base",children:"Total:"}),e.jsx("span",{className:"text-base",children:E(M())})]})]})}),e.jsx(de,{className:"flex justify-end border-t p-4",children:e.jsx(le,{disabled:n,loading:n,idleLabel:"Update Invoice",loadingLabel:"Updating...",idleIcon:e.jsx(Se,{className:"h-4 w-4"}),loadingIcon:e.jsx(be,{className:"h-4 w-4 animate-spin"}),className:"bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600"})})]})]})]})]})]})}export{Lt as default};
