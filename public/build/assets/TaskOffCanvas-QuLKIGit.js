import{r as d,j as e,u as Y,_ as Z}from"./app-Bk4PR63W.js";import{I as h}from"./input-error-aCAuibxh.js";import{S as ee}from"./submit-button-D4bxzCEW.js";import{B as U}from"./button-BGAiRGZg.js";import{C}from"./checkbox-DLdSU6vz.js";import{D as se,C as te}from"./react-datepicker-CNrS-JzU.js";import{U as re}from"./upload-Dy_xQ6ss.js";import{X as ae}from"./x-Dz3a5Yj_.js";import{L as i,I as ie}from"./label-HoiQ3GNm.js";import{R as $,a as S}from"./radio-group-B-KT_SF4.js";import{R as ne}from"./rich-text-editor-B7dyzLTb.js";import{S as z}from"./searchable-select-CIlCAQSR.js";import{S as ce,a as le,b as oe,c as de,d as me}from"./sheet-D7dB8w4W.js";import{T as ue}from"./tag-input-Dqvhr_jb.js";import{t as j}from"./index-D-Gk-yT4.js";import{C as G}from"./clipboard-list-CMM2SLJn.js";import{C as xe}from"./calendar-CgkFkY-D.js";import{F as pe}from"./file-text-BEAzekmp.js";import{S as I}from"./square-check-big-BqCCrkHI.js";import{L as B}from"./loader-circle-BCYeDwOj.js";import{T as he}from"./trash-2-C7f2dPei.js";import{S as ge}from"./save-9NB0FlW1.js";import{P as fe}from"./plus-p8BKPWNs.js";/* empty css            */import"./utils-DKW5XViW.js";import"./index-DDqfYr5D.js";import"./index-Dely6azp.js";import"./index-CPvS59-d.js";import"./createLucideIcon-CdLL0xzd.js";import"./index-BJl2vPHw.js";import"./index-D5x193o-.js";import"./index-BsY2LpXN.js";import"./index-D-w6wlEG.js";import"./floating-ui.react-dom-8ikc8Qbx.js";import"./index-B_GyHV6l.js";import"./index-C79L9l-a.js";import"./index-DiDFMmY4.js";import"./list-TY3Zui4X.js";import"./select-BTxuEGZI.js";import"./chevron-up-F-D43jrY.js";import"./users-DZUcVCZB.js";import"./index-DDNv-7cB.js";import"./badge-BNr9aysp.js";const je=({value:u=[],onChange:f,accept:N,maxFiles:g,label:x="Attachments",description:l="Drag and drop files here, or click to select",disabled:r=!1})=>{const n=d.useRef(null),[T,c]=d.useState(!1),m=()=>{var a;r||(a=n.current)==null||a.click()},A=d.useCallback(a=>{if(!f)return;const p=u?[...u]:[],_=[];for(const b of Array.from(a))p.some(k=>k.name===b.name&&k.size===b.size&&k.lastModified===b.lastModified)||_.push(b);let y=[...p,..._];typeof g=="number"&&(y=y.slice(0,g)),f(y)},[f,u,g]),E=a=>{a.target.files&&A(a.target.files),a.currentTarget.value=""},q=a=>{a.preventDefault(),a.stopPropagation(),c(!1),!r&&a.dataTransfer.files&&a.dataTransfer.files.length>0&&(A(a.dataTransfer.files),a.dataTransfer.clearData())},D=a=>{a.preventDefault(),!r&&c(!0)},F=a=>{a.preventDefault(),c(!1)},v=a=>{if(!f)return;const p=[...u||[]];p.splice(a,1),f(p)};return e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:x}),e.jsxs("div",{className:"rounded-md border border-dashed p-6 text-center transition-colors "+(T?"border-primary/60 bg-primary/5 ":"border-muted-foreground/30 ")+(r?"opacity-60 cursor-not-allowed ":"cursor-pointer hover:border-primary/50 "),onClick:m,onDrop:q,onDragOver:D,onDragLeave:F,children:[e.jsx("input",{ref:n,type:"file",multiple:!0,accept:N,className:"hidden",onChange:E,disabled:r}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(re,{className:"h-5 w-5"}),e.jsx("div",{children:l}),typeof g=="number"&&e.jsxs("div",{className:"text-xs",children:["Up to ",g," files"]})]})]}),u&&u.length>0&&e.jsx("ul",{className:"mt-2 divide-y rounded-md border",children:u.map((a,p)=>e.jsxs("li",{className:"flex items-center justify-between gap-2 p-2 text-sm",children:[e.jsxs("div",{className:"truncate",children:[a.name," ",e.jsxs("span",{className:"text-muted-foreground",children:["(",Math.round(a.size/1024)," KB)"]})]}),e.jsx(U,{type:"button",variant:"ghost",size:"icon",onClick:_=>{_.stopPropagation(),v(p)},disabled:r,"aria-label":`Remove ${a.name}`,children:e.jsx(ae,{className:"h-4 w-4"})})]},p))})]})};function ls({open:u,mode:f,onClose:N,projects:g,taskId:x}){const l=f==="edit",{data:r,setData:n,post:T,processing:c,errors:m,reset:A,transform:E}=Y({project_id:"",title:"",description:"",status:"pending",priority:"medium",due_date:"",assignees:[],create_github_issue:!1,create_jira_issue:!1,github_update:!0,jira_update:!0,tags:[],is_recurring:null,recurring_frequency:""}),[q,D]=d.useState(null),[F,v]=d.useState([]),[a,p]=d.useState(!1),[_,y]=d.useState(!1),[b,L]=d.useState(!1),[k,P]=d.useState([]),[O,R]=d.useState([]),[H,M]=d.useState(!1);d.useEffect(()=>{if(u){if(l&&x){let s="";try{s=route("task.edit-data",x)}catch{s=`/action/app-http-controllers-taskcontroller/edit-data/${x}`}fetch(s).then(t=>{if(!t.ok)throw new Error("Failed to load task");return t.json()}).then(t=>{const o=t.task;R(t.attachments||[]),M(!!t.isProjectOwner),n({project_id:String(o.project_id??""),title:o.title??"",description:o.description??"",status:o.status??"pending",priority:o.priority??"medium",due_date:o.due_date??"",assignees:t.assignedUsers||[],github_update:t.isGithub??!1,jira_update:t.isJira??!1,create_github_issue:!1,create_jira_issue:!1,tags:t.taskTags||[],is_recurring:o.is_recurring??null,recurring_frequency:o.recurring_frequency??""}),D(o.due_date?new Date(o.due_date):null),v(t.potentialAssignees||[]);const w=(t.projects||g||[]).find(Q=>Q.id===o.project_id);w&&(y(!!w.is_github),L(!!w.source&&String(w.source).toLowerCase()==="jira"))}).catch(()=>{j.error("Failed to load task"),N()})}l||(R([]),M(!1),n({project_id:"",title:"",description:"",status:"pending",priority:"medium",due_date:"",assignees:[],create_github_issue:!1,create_jira_issue:!1,github_update:!0,jira_update:!0,tags:[],is_recurring:null,recurring_frequency:""}),D(null),v([]))}},[u,f,x]),d.useEffect(()=>{r.project_id?(p(!0),Z(async()=>{const{potentialAssignees:s}=await import("./TaskController-DRILXs0Z.js").then(t=>t.T);return{potentialAssignees:s}},[]).then(({potentialAssignees:s})=>s.data({params:{project:r.project_id}}).then(t=>v(t)).catch(()=>{j.error("Failed to load potential assignees"),v([])}).finally(()=>p(!1)))):v([])},[r.project_id]),d.useEffect(()=>{const s=g.find(t=>t.id===Number(r.project_id));y(!!(s!=null&&s.is_github)),L(!!(s!=null&&s.source)&&String(s.source).toLowerCase()==="jira")},[r.project_id,g]);const J=s=>{D(s),n("due_date",s?s.toISOString().split("T")[0]:"")},V=s=>{const t=[...r.assignees],o=t.indexOf(s);o===-1?t.push(s):t.splice(o,1),n("assignees",t)},X=s=>{s.preventDefault(),E(t=>({...t,attachments:k})),l&&x?T(route("task.update",x),{forceFormData:!0,onSuccess:()=>{j.success("Task updated successfully"),P([]),window.dispatchEvent(new Event("refresh-tasks")),N()},onError:()=>j.error("Failed to update task"),preserveScroll:!0}):T(route("task.store"),{forceFormData:!0,onSuccess:()=>{j.success("Task created successfully"),A(),P([]),window.dispatchEvent(new Event("refresh-tasks")),N()},onError:()=>j.error("Failed to create task"),preserveScroll:!0})},K=s=>{if(!l||!x)return;let t="";try{t=route("task.attachments.destroy",[x,s.name])}catch{t=`/action/app-http-controllers-taskcontroller/destroyattachment/${x}/${encodeURIComponent(s.name)}`}fetch(t,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{R(o=>o.filter(w=>w.name!==s.name)),j.success("Attachment deleted")}).catch(()=>j.error("Failed to delete attachment"))},W=l?"Edit Task":"Add Task";return e.jsx(ce,{open:u,onOpenChange:s=>!s&&N(),children:e.jsxs(le,{side:"right",className:"overflow-y-auto bg-white pr-6 pb-8 pl-6 sm:max-w-xl md:max-w-2xl dark:bg-neutral-900",children:[e.jsxs(oe,{children:[e.jsxs(de,{className:"flex items-center gap-2 text-xl text-neutral-900 dark:text-white",children:[e.jsx(G,{className:"h-5 w-5 text-neutral-700 dark:text-neutral-300"})," ",W]}),e.jsx(me,{className:"text-sm text-neutral-500 dark:text-neutral-400",children:l?"Update the task details":"Create a new task"})]}),e.jsx("div",{children:e.jsx("form",{className:"flex flex-col gap-8",onSubmit:X,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"project_id",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Project"}),e.jsx(z,{id:"project_id",value:r.project_id,onChange:s=>n("project_id",s),options:g,placeholder:"Select a project",disabled:c,icon:e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(h,{message:m.project_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"due_date",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Due Date ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsx(se,{selected:q,onChange:J,dateFormat:"yyyy-MM-dd",isClearable:!0,disabled:c,placeholderText:"Select due date (optional)",customInput:e.jsx(te,{id:"due_date",icon:e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),disabled:c,tabIndex:3})}),e.jsx(h,{message:m.due_date})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Task Title"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center",children:e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(ie,{id:"title",type:"text",required:!0,autoFocus:!0,tabIndex:1,value:r.title,onChange:s=>n("title",s.target.value),disabled:c,placeholder:"Task title",className:"pl-10"})]}),e.jsx(h,{message:m.title,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"description",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Description ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsx(ne,{value:r.description,onChange:s=>n("description",s),disabled:c,placeholder:"Task description"}),e.jsx(h,{message:m.description})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"status",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Status"}),e.jsxs("div",{className:"relative rounded-md border p-3",children:[e.jsx("div",{className:"pointer-events-none absolute top-3 left-3",children:e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("div",{className:"pl-7",children:e.jsxs($,{value:r.status,onValueChange:s=>n("status",s),className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"pending",id:"status-pending"}),e.jsx(i,{htmlFor:"status-pending",className:"cursor-pointer",children:"Pending"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"in_progress",id:"status-in-progress"}),e.jsx(i,{htmlFor:"status-in-progress",className:"cursor-pointer",children:"In Progress"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"completed",id:"status-completed"}),e.jsx(i,{htmlFor:"status-completed",className:"cursor-pointer",children:"Completed"})]})]})})]}),e.jsx(h,{message:m.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"priority",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Priority"}),e.jsxs("div",{className:"relative rounded-md border p-3",children:[e.jsx("div",{className:"pointer-events-none absolute top-3 left-3",children:e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("div",{className:"pl-7",children:e.jsxs($,{value:r.priority,onValueChange:s=>n("priority",s),className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"low",id:"priority-low"}),e.jsx(i,{htmlFor:"priority-low",className:"cursor-pointer",children:"Low"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"medium",id:"priority-medium"}),e.jsx(i,{htmlFor:"priority-medium",className:"cursor-pointer",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"high",id:"priority-high"}),e.jsx(i,{htmlFor:"priority-high",className:"cursor-pointer",children:"High"})]})]})})]}),e.jsx(h,{message:m.priority})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Assignees ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsxs("div",{className:"relative rounded-md border p-3",children:[e.jsx("div",{className:"pointer-events-none absolute top-3 left-3",children:e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("div",{className:"space-y-2 pl-7",children:a?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-4 w-4 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading assignees..."})]}):F&&F.length>0?F.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:`assignee-${s.id}`,checked:r.assignees.includes(s.id),onCheckedChange:()=>V(s.id),disabled:c}),e.jsxs(i,{htmlFor:`assignee-${s.id}`,className:"cursor-pointer text-sm",children:[s.name,s.email?` (${s.email})`:""]})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:r.project_id?"No potential assignees available for this project":"Select a project first"})})]}),e.jsx(h,{message:m.assignees})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{className:"text-sm font-medium",children:["Tags ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsx(ue,{value:r.tags,onChange:s=>n("tags",s),placeholder:"Add tags (optional)"}),e.jsx(h,{message:m.tags})]}),!l&&_&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"create_github_issue",checked:!!r.create_github_issue,onCheckedChange:s=>n("create_github_issue",s===!0),disabled:c}),e.jsx(i,{htmlFor:"create_github_issue",className:"cursor-pointer text-sm",children:"Create issue on GitHub"})]}),!l&&b&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"create_jira_issue",checked:!!r.create_jira_issue,onCheckedChange:s=>n("create_jira_issue",s===!0),disabled:c}),e.jsx(i,{htmlFor:"create_jira_issue",className:"cursor-pointer text-sm",children:"Create issue on Jira"})]}),l&&_&&e.jsxs("div",{className:"ml-1 space-y-2",children:[e.jsxs(i,{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"github_update",checked:!!r.github_update,onCheckedChange:s=>n("github_update",s===!0),disabled:c}),e.jsx("span",{className:"text-sm font-medium",children:"Update GitHub issue when task is updated"})]}),e.jsx(h,{message:m.github_update})]}),l&&b&&e.jsxs("div",{className:"ml-1 space-y-2",children:[e.jsxs(i,{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"jira_update",checked:!!r.jira_update,onCheckedChange:s=>n("jira_update",s===!0),disabled:c}),e.jsx("span",{className:"text-sm font-medium",children:"Update Jira issue when task is updated"})]}),e.jsx(h,{message:m.jira_update})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Recurring"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"is_recurring",checked:!!r.is_recurring,onCheckedChange:s=>{const t=s===!0;n("is_recurring",t),t||n("recurring_frequency","")},disabled:c}),e.jsx(i,{htmlFor:"is_recurring",className:"cursor-pointer text-sm",children:"Is this a recurring task?"})]}),r.is_recurring===!0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"recurring_frequency",className:"text-sm font-medium",children:"Frequency"}),e.jsx(z,{id:"recurring_frequency",value:r.recurring_frequency||"",onChange:s=>n("recurring_frequency",s),options:[{id:"daily",name:"Daily"},{id:"weekly",name:"Weekly"},{id:"every_other_week",name:"Every other week"},{id:"monthly",name:"Monthly"}],placeholder:"Select frequency",disabled:c}),e.jsx(h,{message:m.recurring_frequency})]})]}),e.jsx(je,{value:k,onChange:P,label:"Attachments",description:"Drag & drop files here, or click to select",disabled:c}),l&&O.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Existing Attachments"}),e.jsx("ul",{className:"mt-2 divide-y rounded-md border",children:O.map(s=>e.jsxs("li",{className:"flex items-center justify-between gap-3 p-3 text-sm",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"truncate text-blue-600 hover:underline dark:text-blue-400",children:s.name}),e.jsxs("span",{className:"shrink-0 text-xs text-muted-foreground",children:[(s.size/1024).toFixed(1)," KB"]})]}),H&&e.jsx("div",{className:"shrink-0",children:e.jsxs(U,{type:"button",variant:"outline",size:"sm",className:"h-7 w-7 border-red-200 bg-red-100 p-0 text-red-600 hover:bg-red-200 dark:border-red-800/50 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30",onClick:()=>K(s),"aria-label":`Delete ${s.name}`,title:"Delete",children:[e.jsx(he,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})})]},s.name))})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3 border-t border-neutral-200 pt-6 dark:border-neutral-800",children:[e.jsx(U,{type:"button",variant:"outline",onClick:N,disabled:c,className:"border-neutral-200 hover:bg-neutral-100 hover:text-neutral-900 dark:border-neutral-800 dark:hover:bg-neutral-800 dark:hover:text-neutral-100",children:"Cancel"}),e.jsx(ee,{loading:c,idleLabel:l?"Update Task":"Create Task",loadingLabel:l?"Updating...":"Creating...",idleIcon:l?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(fe,{className:"h-4 w-4"}),loadingIcon:e.jsx(B,{className:"h-4 w-4 animate-spin"}),className:"bg-gray-900 text-white hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600"})]})]})})})]})})}export{ls as default};
