import{r,j as e,H as ee,b as y}from"./app-CE94QcfB.js";import{B as l}from"./badge-Do30HICq.js";import{B as k}from"./button-CSc-Cw7e.js";import{R as P}from"./rich-text-editor-bUsVxFlH.js";import{S as se,a as te,b as ae,c as re}from"./sheet-0Ok6l0ab.js";import{p as U}from"./purify.es-CEVJ7K31.js";import{G as ne}from"./glasses-BsUinA32.js";import{C as ie}from"./calendar-C8zGel57.js";import{E as le}from"./external-link-CXzUVR5e.js";import{S as de}from"./save-B95-0usG.js";import{X as oe}from"./x-BKkU3iVo.js";import{P as ce,T as me}from"./trash-uMJ2IdmR.js";import{T as xe}from"./trash-2-BRVXkUm4.js";/* empty css            */import"./index-Becnjq-x.js";import"./utils-DKW5XViW.js";import"./createLucideIcon-D9NWueAg.js";import"./list-BjNAZPQN.js";import"./index-fJEy3cUu.js";import"./index-gOG35dkf.js";import"./index-OH_msQzS.js";import"./index-DkUby8a3.js";import"./index-BC-ip4sp.js";import"./index-CSGd7LPk.js";function Oe({open:c,onClose:G,taskId:d}){var H,L,M,O,R,$,A;const[t,w]=r.useState(null),[h,S]=r.useState([]),[C,D]=r.useState([]),[Y,_]=r.useState(!1),[T,E]=r.useState(null),[p,g]=r.useState([]),[m,f]=r.useState(""),[B,x]=r.useState(null),[j,o]=r.useState(""),[I,u]=r.useState(!1),[z,b]=r.useState(null),N=s=>s.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim(),v=async()=>{var s;if(d){_(!0),E(null);try{let a="";try{a=route("task.detail-data",d)}catch{a=`/action/app-http-controllers-taskcontroller/detail-data/${d}`}const n=await fetch(a);if(!n.ok)throw new Error("Failed to load task details");const i=await n.json();w(i.task),S(i.attachments||[]),D(i.mentionableUsers||[]),g(Array.isArray((s=i.task)==null?void 0:s.comments)?i.task.comments:[])}catch(a){const n=a instanceof Error?a.message:"Failed to load task details";E(n)}finally{_(!1)}}};r.useEffect(()=>{c&&d&&v(),c||(w(null),S([]),D([]),g([]),f(""),x(null),o(""),u(!1),b(null))},[c,d]);const K=({html:s})=>{const a=typeof window<"u"?U.sanitize(s):s;return e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:a}})},X=r.useMemo(()=>t?`${t.title} · Task Details`:"Task Details",[t]),q=s=>{switch(s){case"high":return e.jsx(l,{variant:"destructive",className:"capitalize",children:s});case"medium":return e.jsx(l,{variant:"default",className:"capitalize",children:s});case"low":return e.jsx(l,{variant:"outline",className:"capitalize",children:s})}},J=s=>{switch(s){case"completed":return e.jsx(l,{variant:"success",className:"capitalize",children:s.replace("_"," ")});case"in_progress":return e.jsx(l,{variant:"warning",className:"capitalize",children:s.replace("_"," ")});case"pending":return e.jsx(l,{variant:"secondary",className:"capitalize",children:s.replace("_"," ")})}},F=s=>{if(!s)return"";const a=new Date(s),n=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),Z=String(a.getDate()).padStart(2,"0");return`${n}-${i}-${Z}`},Q=async s=>{if(s.preventDefault(),!t||!N(m))return;const a=m;await y.post(route("task.comments.store",{task:t.id}),{body:a},{preserveScroll:!0,onSuccess:()=>{g(n=>[...n,{id:Date.now(),body:a,user:{id:void 0,name:"You"},created_at:new Date().toISOString()}]),f("")}})},V=async s=>{t&&N(j)&&await y.put(route("task.comments.update",{task:t.id,comment:s}),{body:j},{preserveScroll:!0,onFinish:()=>{x(null),o(""),v()}})},W=async()=>{!t||z==null||await y.delete(route("task.comments.destroy",{task:t.id,comment:z}),{preserveScroll:!0,onFinish:()=>{u(!1),b(null),v()}})};return e.jsxs(se,{open:c,onOpenChange:s=>!s&&G(),children:[e.jsx(ee,{title:X}),e.jsxs(te,{side:"right",className:"overflow-y-auto bg-white pr-6 pb-8 pl-6 sm:max-w-md md:max-w-lg dark:bg-neutral-900",children:[e.jsx(ae,{className:"mb-2",children:e.jsxs(re,{className:"flex items-center gap-2 text-xl text-neutral-900 dark:text-white",children:[e.jsx(ne,{className:"h-5 w-5 text-neutral-700 dark:text-neutral-300"})," Task Details"]})}),Y?e.jsx("div",{className:"py-10 text-center text-sm text-muted-foreground",children:"Loading..."}):T?e.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 p-4 text-sm text-red-600 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300",children:T}):t?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:t.title}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"inline-flex items-center gap-2",children:e.jsx("span",{className:"text-muted-foreground",children:t.project.name})}),e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsx("span",{className:"inline-flex items-center gap-2",children:J(t.status)}),e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsx("span",{className:"inline-flex items-center gap-2",children:q(t.priority)}),t.due_date&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),"Due ",F(t.due_date)]})]})]})]}),t.assignees&&t.assignees.length>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:t.assignees.map(s=>e.jsx("span",{className:"flex items-center gap-2 bg-background px-3 py-1 text-sm shadow-sm",children:e.jsx("span",{children:s.name})},s.id))})}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map(s=>e.jsx(l,{style:{backgroundColor:s.color,color:"#fff"},children:s.name},s.id))})})]}),e.jsx("div",{children:e.jsx("div",{className:"rounded-lg bg-muted/40 p-4",children:t.description?e.jsx("div",{className:"text-sm",children:e.jsx(K,{html:t.description})}):e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-dashed bg-background/50 p-3 text-sm text-muted-foreground",children:[e.jsx("span",{children:"No description provided"}),e.jsx("span",{className:"hidden md:inline",children:"— add one from the edit page"})]})})}),((H=t.meta)==null?void 0:H.source_url)&&e.jsx("div",{children:e.jsx("div",{className:"bg-muted/40 p-4",children:e.jsx("div",{className:"space-y-2",children:(((L=t.meta)==null?void 0:L.source)||((M=t.meta)==null?void 0:M.source_number))&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[((O=t.meta)==null?void 0:O.source)&&e.jsx("span",{className:"font-medium text-foreground",children:t.meta.source}),((R=t.meta)==null?void 0:R.source)&&(($=t.meta)==null?void 0:$.source_number)&&e.jsx("span",{className:"mx-1",children:"•"}),((A=t.meta)==null?void 0:A.source_number)&&e.jsxs("span",{children:["#",t.meta.source_number]}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsx("a",{href:t.meta.source_url,target:"_blank",rel:"noreferrer",className:"inline-flex items-center text-primary hover:underline",children:e.jsx(le,{className:"h-4 w-4"})})]})})})}),h&&h.length>0&&e.jsx("div",{children:e.jsx("div",{className:"bg-muted/40 p-4",children:e.jsx("ul",{className:"divide-y",children:h.map(s=>e.jsx("li",{className:"flex items-center justify-between gap-3 p-3 text-sm",children:e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"truncate text-blue-600 hover:underline dark:text-blue-400",children:s.name}),e.jsxs("span",{className:"shrink-0 text-xs text-muted-foreground",children:[(s.size/1024).toFixed(1)," KB"]})]})},s.name))})})}),e.jsx("div",{children:e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-4",children:[e.jsx("div",{className:"space-y-4",children:p&&p.length>0?p.map(s=>{var a;return e.jsxs("div",{className:"rounded-md bg-background p-3 shadow-sm",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:((a=s.user)==null?void 0:a.name)??"User"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:F(s.created_at)}),B===s.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",title:"Save comment",className:"cursor-pointer text-green-600 hover:text-green-700",onClick:()=>V(s.id),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",title:"Cancel edit",className:"cursor-pointer text-muted-foreground hover:text-foreground",onClick:()=>{x(null),o("")},children:e.jsx(oe,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",title:"Edit comment",className:"cursor-pointer text-blue-600 hover:text-blue-700",onClick:()=>{x(s.id),o(s.body)},children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",title:"Delete comment",className:"cursor-pointer text-red-500 hover:text-red-600",onClick:()=>{b(s.id),u(!0)},children:e.jsx(me,{className:"h-4 w-4"})})]})]})]}),B===s.id?e.jsx(P,{value:j,onChange:o,placeholder:"Edit comment...",minRows:4,mentions:C}):e.jsx("div",{className:"prose prose-sm dark:prose-invert mt-4 max-w-none text-sm",dangerouslySetInnerHTML:{__html:typeof window<"u"?U.sanitize(s.body||""):s.body||""}})]},s.id)}):e.jsx("div",{className:"rounded-md border border-dashed bg-background/50 p-3 text-sm text-muted-foreground",children:"No comments yet"})}),e.jsx("form",{onSubmit:Q,className:"mt-2",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(P,{value:m,onChange:f,placeholder:"Add a comment...",minRows:4,mentions:C}),e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{type:"submit",disabled:!N(m),className:"flex items-center gap-2 bg-gray-900 text-sm hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Post Comment"})})]})}),I&&e.jsxs("div",{className:"mt-3 rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300",children:[e.jsx("div",{className:"mb-2 font-medium",children:"Delete this comment?"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(k,{onClick:W,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Delete Comment"]})]})]})]})})]}):e.jsx("div",{className:"py-10 text-center text-sm text-muted-foreground",children:"No task selected"})]})]})}export{Oe as default};
