import{c as xe,r as l,j as e,H as ue,b as B}from"./app-CE94QcfB.js";import{E as ge}from"./action-buttons-DllMgloq.js";import{A as q}from"./add-new-button-u8sEV8pU.js";import{A as z,a as G,b as Y,c as Q,d as J,e as K,f as W,g as X}from"./alert-dialog-Dv5S2ujf.js";import{B as D}from"./button-CSc-Cw7e.js";import{C as he,a as pe,b as fe,c as Z,d as ye}from"./card-BF0DTRGt.js";import{a as je,b as be,c as ve,D as I}from"./dropdown-menu-Dy5Hq4rj.js";import{L as n,I as Ne}from"./label-DISzI683.js";import{R as ke,a as x}from"./radio-group-DlOqcici.js";import{T as we,a as Se,b as Ce,c as o,d as De,e as Ie,f as d}from"./table-C7t7xskR.js";import{M as Ee}from"./master-layout-tsVhh441.js";import{q as Fe,o as Te}from"./utils-DKW5XViW.js";import{i as _e}from"./InvoiceController-onzgdswi.js";import{t as V}from"./index-C5Svuudg.js";import Ae from"./InvoiceFiltersOffCanvas-BKFUrwgi.js";import{F as $e}from"./filter-BedxScMf.js";import{P as ee}from"./plus-CeOzYAGh.js";import{L as y}from"./loader-circle-D1ym3s0F.js";import{F as te}from"./file-text-D51RJe6F.js";import{E as Oe}from"./ellipsis-vertical-COc6NTvl.js";import{D as Pe}from"./download-BHzq6k4i.js";import{M as Ue}from"./mail-3NLULyqe.js";import{C as Le}from"./calendar-C8zGel57.js";/* empty css            */import"./index-gOG35dkf.js";import"./index-Becnjq-x.js";import"./index-fJEy3cUu.js";import"./index-OH_msQzS.js";import"./index-DkUby8a3.js";import"./index-BC-ip4sp.js";import"./index-CSGd7LPk.js";import"./index-DmtIMq0f.js";import"./floating-ui.react-dom-ODH34Sgt.js";import"./index-DwOlKDQm.js";import"./index-C7hwMZoy.js";import"./index-DssjTqXu.js";import"./createLucideIcon-D9NWueAg.js";import"./cookie-consent-CR7wTwap.js";import"./select-D_MCfbK8.js";import"./chevron-up-BMiBX3If.js";import"./TaskController-DRILXs0Z.js";import"./jira-icon-pYe84P2s.js";import"./x-BKkU3iVo.js";import"./trash-2-BRVXkUm4.js";import"./sheet-0Ok6l0ab.js";import"./clock-CV0oisNo.js";import"./appearance-dropdown-CplWtr1N.js";import"./circle-alert-5FNlBjr8.js";import"./checkbox-TCMWq4Ph.js";import"./badge-Do30HICq.js";import"./chevron-right-BzTA_0kR.js";import"./settings-Bjly2KGq.js";import"./bell-CbXQzXBs.js";import"./users-Dah8edja.js";import"./app-logo-icon-DHSG1eGj.js";import"./github-CZtBj8bQ.js";import"./log-out-BQwzfcg9.js";import"./building-BzSs3yfb.js";import"./projector-C9mKpjiA.js";import"./clipboard-list-BccoXVyt.js";import"./timer-BE1bBtuS.js";import"./square-check-big-B68kPrbC.js";import"./InvoiceFilters-DFa0BcF9.js";import"./filter-button-B8qubTbI.js";import"./react-datepicker-Cpw6gAu9.js";import"./searchable-select-BHMLfEm8.js";import"./search-4eIqUzEe.js";import"./briefcase-BmAm87Tp.js";import"./timer-reset-XwZDwRHv.js";import"./sliders-horizontal-CZJRYnNd.js";const Me=[{title:"Invoices",href:"/invoice"}];function aa(){const{filters:i,clients:ae}=xe().props,[u,j]=l.useState([]),[E,F]=l.useState(!0),[T,_]=l.useState(!1),[re,b]=l.useState(!1),[se,v]=l.useState(!1),[r,h]=l.useState(null),[N,A]=l.useState(!1),[k,$]=l.useState(!1),[c,O]=l.useState(""),[w,p]=l.useState(""),[ie,P]=l.useState(!1),[a,U]=l.useState({search:(i==null?void 0:i.search)||"",client:(i==null?void 0:i.client)||"all",status:(i==null?void 0:i.status)||"all","created-date-from":(i==null?void 0:i["created-date-from"])||null,"created-date-to":(i==null?void 0:i["created-date-to"])||null}),S=async t=>{F(!0),_(!1);try{const s=t?{...t}:void 0;s&&(s.client==="all"&&(s.client=""),s.status==="all"&&(s.status="")),j(await _e.data({params:s}))}catch(s){console.error("Error fetching invoices:",s),_(!0)}finally{F(!1)}},m=t=>t instanceof Date?t.toISOString().split("T")[0]:typeof t=="string"&&t?t:"";l.useEffect(()=>{const t=Fe(),s={search:t.search||"",client:t.client||"all",status:t.status||"all","created-date-from":t["created-date-from"]||null,"created-date-to":t["created-date-to"]||null};U(s),S(s).then()},[]);const L=(t,s="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:s,currencyDisplay:"code"}).format(t),le=t=>{switch(t){case"draft":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";case"sent":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"paid":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"partially_paid":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"overdue":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"cancelled":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},f=t=>t.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase()),ne=t=>{h(t),b(!0)},M=t=>{h(t),O(t.status),p(t.paid_amount.toString()),v(!0)},oe=async()=>{if(r){A(!0);try{await B.post(route("invoice.sendEmail",r.id)),j(u.map(t=>t.id===r.id?{...t,status:"sent"}:t)),b(!1),h(null)}catch(t){console.error("Error sending invoice email:",t)}finally{A(!1)}}},de=async()=>{if(r){$(!0);try{await B.post(route("invoice.updateStatus",r.id),{status:c,paid_amount:w}),j(u.map(t=>t.id===r.id?{...t,status:c,paid_amount:parseFloat(w)}:t)),V.success(`Invoice status updated to ${f(c)}`),v(!1),h(null)}catch(t){console.error("Error updating invoice status:",t),V.error("Failed to update invoice status")}finally{$(!1)}}};return e.jsxs(Ee,{breadcrumbs:Me,children:[e.jsx(ue,{title:"Invoices"}),e.jsxs("div",{className:"mx-auto flex flex-col gap-6 p-3",children:[e.jsxs("section",{className:"mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-100",children:"Invoice Management"}),e.jsx("p",{className:"mt-1 text-gray-500 dark:text-gray-400",children:"Manage your invoices"})]}),e.jsxs(he,{className:"transition-all hover:shadow-md",children:[e.jsxs(pe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(fe,{className:"text-xl",children:"Invoices"}),e.jsx(Z,{children:E?"Loading invoices...":T?"Failed to load invoices":`You have ${u.length} invoices`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:a.search||a.client!=="all"||a.status!=="all"||a["created-date-from"]||a["created-date-to"]?"default":"outline",className:`flex items-center gap-2 ${a.search||a.client!=="all"||a.status!=="all"||a["created-date-from"]||a["created-date-to"]?"border-primary/20 bg-primary/10 text-primary hover:border-primary/30 hover:bg-primary/20 dark:border-primary/30 dark:bg-primary/20 dark:text-primary-foreground dark:hover:bg-primary/30":"text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800"}`,onClick:()=>P(!0),children:[e.jsx($e,{className:`h-4 w-4 ${a.search||a.client!=="all"||a.status!=="all"||a["created-date-from"]||a["created-date-to"]?"text-primary dark:text-primary-foreground":""}`}),e.jsx("span",{children:a.search||a.client!=="all"||a.status!=="all"||a["created-date-from"]||a["created-date-to"]?"Filters Applied":"Filters"})]}),e.jsx(ge,{href:`${route("invoice.export")}?${Te({search:a.search||"",client:a.client||"",status:a.status||"","created-date-from":m(a["created-date-from"]),"created-date-to":m(a["created-date-to"])})}`,label:"Export"}),e.jsxs(q,{href:route("invoice.create"),children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Invoice"})]})]})]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:(a.search||a.client!=="all"||a.status!=="all"||a["created-date-from"]||a["created-date-to"])&&e.jsx(Z,{children:(()=>{let t="";return a["created-date-from"]&&a["created-date-to"]?t=`Showing invoices from ${m(a["created-date-from"])} to ${m(a["created-date-to"])}`:a["created-date-from"]?t=`Showing invoices from ${m(a["created-date-from"])}`:a["created-date-to"]&&(t=`Showing invoices until ${m(a["created-date-to"])}`),a.status&&(t?t+=` with status "${f(a.status)}"`:t=`Showing invoices with status "${f(a.status)}"`),a.client&&(t?t+=" for selected client":t="Showing invoices for selected client"),a.search&&(t?t+=` matching "${a.search}"`:t=`Showing invoices matching "${a.search}"`),t})()})})]}),e.jsx(ye,{children:E?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(y,{className:"mb-4 h-12 w-12 animate-spin text-muted-foreground/50"}),e.jsx("h3",{className:"mb-1 text-lg font-medium",children:"Loading Invoices"}),e.jsx("p",{className:"mb-4 text-muted-foreground",children:"Please wait while we fetch your invoices..."})]}):T?e.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 p-6 dark:border-red-800 dark:bg-red-900/20",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(te,{className:"mb-4 h-12 w-12 text-red-500"}),e.jsx("h3",{className:"mb-1 text-lg font-medium text-red-700 dark:text-red-400",children:"Failed to Load Invoices"}),e.jsx("p",{className:"mb-4 text-red-600 dark:text-red-300",children:"There was an error loading your invoices. Please try again."}),e.jsxs(D,{onClick:()=>S(),className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Retry"})]})]})}):u.length>0?e.jsxs(we,{children:[e.jsx(Se,{children:e.jsxs(Ce,{children:[e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Invoice #"}),e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Client"}),e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Issue Date"}),e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Due Date"}),e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Amount"}),e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx(o,{className:"dark:bg-gray-750 bg-gray-50 text-right text-xs font-medium text-gray-500 dark:text-gray-400",children:"Actions"})]})}),e.jsx(De,{children:u.map(t=>e.jsxs(Ie,{className:"dark:hover:bg-gray-750 border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700",children:[e.jsx(d,{className:"font-medium text-gray-800 dark:text-gray-200",children:t.invoice_number}),e.jsx(d,{className:"text-sm text-gray-700 dark:text-gray-300",children:t.client.name}),e.jsx(d,{className:"text-sm text-gray-700 dark:text-gray-300",children:new Date(t.issue_date).toISOString().split("T")[0]}),e.jsx(d,{className:"text-sm text-gray-700 dark:text-gray-300",children:new Date(t.due_date).toISOString().split("T")[0]}),e.jsx(d,{className:"text-sm text-gray-700 dark:text-gray-300",children:L(t.total_amount,t.currency)}),e.jsx(d,{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${le(t.status)} cursor-pointer hover:opacity-80`,onClick:()=>M(t),title:"Click to update status",children:f(t.status)})}),e.jsx(d,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs(je,{children:[e.jsx(be,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0 text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700",children:e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",className:"w-48",children:[e.jsx("a",{href:route("invoice.downloadPdf",t.id),target:"_blank",rel:"noopener noreferrer",children:e.jsxs(I,{className:"group cursor-pointer",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4 text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300"}),e.jsx("span",{children:"Download PDF"})]})}),e.jsxs(I,{className:"group cursor-pointer",onClick:()=>ne(t),disabled:t.status==="sent"||t.status==="paid",children:[e.jsx(Ue,{className:`mr-2 h-4 w-4 ${t.status==="sent"||t.status==="paid"?"text-gray-300 dark:text-gray-600":"text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300"}`}),e.jsx("span",{className:t.status==="sent"||t.status==="paid"?"text-gray-300 dark:text-gray-600":"",children:"Send Email"})]}),e.jsxs(I,{className:"group cursor-pointer",onClick:()=>M(t),children:[e.jsx(Le,{className:"mr-2 h-4 w-4 text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300"}),e.jsx("span",{children:"Update Status"})]})]})]})})})]},t.id))})]}):e.jsx("div",{className:"rounded-md border bg-muted/5 p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(te,{className:"mb-4 h-12 w-12 text-muted-foreground/50"}),e.jsx("h3",{className:"mb-1 text-lg font-medium",children:"No Invoices"}),e.jsx("p",{className:"mb-4 text-muted-foreground",children:"You haven't created any invoices yet."}),e.jsxs(q,{href:route("invoice.create"),children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Invoice"})]})]})})})]})]}),e.jsx(z,{open:re,onOpenChange:b,children:e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx(Q,{children:"Send Invoice Email"}),e.jsx(J,{children:r&&e.jsxs(e.Fragment,{children:["This will send invoice #",r.invoice_number," to ",r.client.name,".",r.status!=="sent"&&e.jsx("div",{className:"mt-2",children:'The invoice status will be updated to "Sent".'})]})})]}),e.jsxs(K,{children:[e.jsx(W,{disabled:N,children:"Cancel"}),e.jsx(X,{onClick:oe,disabled:N,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:N?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):"Send Email"})]})]})}),e.jsx(z,{open:se,onOpenChange:v,children:e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx(Q,{children:"Update Invoice Status"}),e.jsx(J,{children:r&&e.jsxs(e.Fragment,{children:["Update status for invoice #",r.invoice_number]})})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"status",className:"text-sm font-medium",children:"Status"}),e.jsx("div",{className:"relative rounded-md border p-3",children:e.jsxs(ke,{value:c,onValueChange:t=>{O(t),t==="paid"&&r?p(r.total_amount.toString()):t==="partially_paid"&&p("0")},className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{value:"draft",id:"status-draft"}),e.jsx(n,{htmlFor:"status-draft",className:"cursor-pointer",children:"Draft"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{value:"sent",id:"status-sent"}),e.jsx(n,{htmlFor:"status-sent",className:"cursor-pointer",children:"Sent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{value:"paid",id:"status-paid"}),e.jsx(n,{htmlFor:"status-paid",className:"cursor-pointer",children:"Paid"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{value:"partially_paid",id:"status-partially-paid"}),e.jsx(n,{htmlFor:"status-partially-paid",className:"cursor-pointer",children:"Partially Paid"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{value:"overdue",id:"status-overdue"}),e.jsx(n,{htmlFor:"status-overdue",className:"cursor-pointer",children:"Overdue"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{value:"cancelled",id:"status-cancelled"}),e.jsx(n,{htmlFor:"status-cancelled",className:"cursor-pointer",children:"Cancelled"})]})]})})]}),(c==="paid"||c==="partially_paid")&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"paid_amount",className:"text-sm font-medium",children:"Paid Amount"}),e.jsx(Ne,{id:"paid_amount",type:"number",min:"0",step:"0.01",value:w,onChange:t=>p(t.target.value),placeholder:"0.00"}),r&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total invoice amount: ",L(r.total_amount,r.currency)]})]})]}),e.jsxs(K,{children:[e.jsx(W,{disabled:k,children:"Cancel"}),e.jsx(X,{onClick:de,disabled:k,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:k?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Status"})]})]})}),e.jsx(Ae,{open:ie,onOpenChange:P,filters:{search:a.search||"",client:a.client==="all"?"":a.client||"",status:a.status==="all"?"":a.status||"","created-date-from":a["created-date-from"]?String(a["created-date-from"]):null,"created-date-to":a["created-date-to"]?String(a["created-date-to"]):null},clients:ae,onApply:t=>{const s={search:t.search||"",client:t.client||"all",status:t.status||"all","created-date-from":t["created-date-from"]||null,"created-date-to":t["created-date-to"]||null};U(s);try{const C=new URLSearchParams(window.location.search),g=(R,me)=>{const H=me??"";H?C.set(R,H):C.delete(R)};g("search",t.search||""),g("client",t.client||""),g("status",t.status||""),g("created-date-from",t["created-date-from"]),g("created-date-to",t["created-date-to"]);const ce=`${window.location.pathname}?${C.toString()}`;window.history.replaceState({},"",ce)}catch{}S({search:t.search||"",client:t.client||"",status:t.status||"","created-date-from":t["created-date-from"]||null,"created-date-to":t["created-date-to"]||null}).then(()=>{})}})]})}export{aa as default};
