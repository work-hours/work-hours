import{r as _,u as V,j as e}from"./app-CE94QcfB.js";import{I as v}from"./input-error-9xWteZf8.js";import{S as W}from"./submit-button-B_eWnsfJ.js";import{B as q}from"./button-CSc-Cw7e.js";import{C as L}from"./checkbox-TCMWq4Ph.js";import{L as p,I as P}from"./label-DISzI683.js";import{S as z}from"./searchable-select-BHMLfEm8.js";import{S as G,a as J,b as K,c as Q,d as X}from"./select-D_MCfbK8.js";import{S as Y,a as Z,b as ee,c as re,d as te}from"./sheet-0Ok6l0ab.js";import{T as ae}from"./textarea-49cOPKwt.js";import{t as y}from"./index-C5Svuudg.js";import{S as U}from"./save-B95-0usG.js";import{F as D}from"./folder-plus-Uh_yi0v0.js";import{F as se}from"./file-text-D51RJe6F.js";import{B as ne}from"./building-BzSs3yfb.js";import{c as le}from"./createLucideIcon-D9NWueAg.js";import{U as R}from"./users-Dah8edja.js";import{L as ie}from"./loader-circle-D1ym3s0F.js";/* empty css            */import"./utils-DKW5XViW.js";import"./index-Becnjq-x.js";import"./index-gOG35dkf.js";import"./index-DssjTqXu.js";import"./index-DwOlKDQm.js";import"./index-CSGd7LPk.js";import"./index-DkUby8a3.js";import"./index-BC-ip4sp.js";import"./index-DmtIMq0f.js";import"./floating-ui.react-dom-ODH34Sgt.js";import"./index-OH_msQzS.js";import"./chevron-up-BMiBX3If.js";import"./index-fJEy3cUu.js";import"./x-BKkU3iVo.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M17 6.1H3",key:"wptmhv"}],["path",{d:"M21 12.1H3",key:"1j38uz"}],["path",{d:"M15.1 18H3",key:"1nb16a"}]],oe=le("Text",de);function Ve({open:h,mode:w,onClose:g,clients:B,teamMembers:k,currencies:m,projectId:b}){const c=w==="edit",[$,S]=_.useState(!1),[j,C]=_.useState(k),{data:a,setData:l,post:A,put:H,processing:d,errors:f,reset:F}=V({name:"",description:"",client_id:"",team_members:[],approvers:[],team_member_rates:{}});_.useEffect(()=>{h&&c&&b&&fetch(route("project.edit-data",b)).then(r=>r.json()).then(r=>{const t=r.project;S(!!(t!=null&&t.is_imported)),C(r.teamMembers||k);const n={};r.teamMemberRates&&Object.entries(r.teamMemberRates).forEach(([x,s])=>{var i;n[Number(x)]={hourly_rate:((s==null?void 0:s.hourly_rate)??0).toString(),currency:(s==null?void 0:s.currency)??((i=m[0])==null?void 0:i.code)??"USD"}}),l({name:t.name||"",description:t.description||"",client_id:t.client_id?String(t.client_id):"",team_members:r.assignedTeamMembers||[],approvers:r.assignedApprovers||[],team_member_rates:n})}).catch(()=>{y.error("Failed to load project"),g()}),h&&!c&&(S(!1),C(k),l({name:"",description:"",client_id:"",team_members:[],approvers:[],team_member_rates:{}})),h||F()},[h,w,b]);const O=r=>{r.preventDefault(),c&&b?H(route("project.update",b),{onSuccess:()=>{y.success("Project updated successfully"),window.dispatchEvent(new Event("refresh-projects")),g()},onError:()=>y.error("Failed to update project"),preserveScroll:!0}):A(route("project.store"),{onSuccess:()=>{y.success("Project created successfully"),window.dispatchEvent(new Event("refresh-projects")),g(),F()},onError:()=>y.error("Failed to create project"),preserveScroll:!0})},I=r=>{var x;const t=[...a.team_members],n=t.indexOf(r);if(n===-1){t.push(r);const s=j.find(i=>i.id===r);if(s&&!s.non_monetary){const i={...a.team_member_rates};i[r]={hourly_rate:(s.hourly_rate??0).toString(),currency:s.currency??((x=m[0])==null?void 0:x.code)??"USD"},l("team_member_rates",i)}}else{t.splice(n,1);const s={...a.team_member_rates};delete s[r],l("team_member_rates",s)}l("team_members",t),n!==-1&&a.approvers.includes(r)&&E(r)},E=r=>{if(!a.team_members.includes(r))return;const t=[...a.approvers],n=t.indexOf(r);n===-1?t.push(r):t.splice(n,1),l("approvers",t)};return e.jsx(Y,{open:h,onOpenChange:r=>!r&&g(),children:e.jsxs(Z,{side:"right",className:"overflow-y-auto bg-white pr-6 pb-8 pl-6 sm:max-w-2xl dark:bg-neutral-900",children:[e.jsxs(ee,{children:[e.jsx(re,{className:"flex items-center gap-2 text-xl text-neutral-900 dark:text-white",children:c?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5 text-neutral-700 dark:text-neutral-300"})," Edit Project"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-5 w-5 text-neutral-700 dark:text-neutral-300"})," Add Project"]})}),e.jsx(te,{className:"text-sm text-neutral-500 dark:text-neutral-400",children:c?"Update the project details":"Create a new project"})]}),e.jsx("form",{className:"mt-4 flex flex-col gap-8",onSubmit:O,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Project Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center",children:e.jsx(se,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})}),e.jsx(P,{id:"name",type:"text",required:!0,autoFocus:!0,tabIndex:1,value:a.name,onChange:r=>l("name",r.target.value),disabled:d||$,placeholder:"Project name",className:"border-neutral-200 bg-white pl-10 ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})]}),e.jsx(v,{message:f.name,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"client_id",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Client ",e.jsx("span",{className:"text-xs text-gray-500",children:"(optional)"})]}),e.jsx(z,{id:"client_id",value:a.client_id,onChange:r=>l("client_id",String(r)),options:B,placeholder:"Select a client",disabled:d,icon:e.jsx(ne,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),className:"border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"}),e.jsx(v,{message:f.client_id})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"description",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Description ",e.jsx("span",{className:"text-xs text-gray-500",children:"(optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 top-0 left-3 flex items-center pt-2",children:e.jsx(oe,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})}),e.jsx(ae,{id:"description",tabIndex:2,value:a.description,onChange:r=>l("description",r.target.value),disabled:d,placeholder:"Project description",className:"min-h-[100px] border-neutral-200 bg-white pl-10 ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})]}),e.jsx(v,{message:f.description})]})]}),e.jsxs("div",{className:"space-y-5 pt-2",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Team Assignment"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Team Members ",e.jsx("span",{className:"text-xs text-gray-500",children:"(optional)"})]}),e.jsxs("div",{className:"relative rounded-md border border-neutral-200 shadow-sm dark:border-neutral-700",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-neutral-200 bg-neutral-50 px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800/50",children:[e.jsx(R,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Select team members and set hourly rates"})]}),e.jsx("div",{className:"p-3",children:j&&j.length>0?e.jsx("div",{className:"grid gap-2",children:j.map(r=>{var s,i,M;const t=a.team_members.includes(r.id),n=t&&!r.non_monetary,x=((s=a.team_member_rates[r.id])==null?void 0:s.hourly_rate)??(r.hourly_rate??0).toString();return e.jsxs("div",{className:`flex flex-wrap items-center gap-3 rounded-md px-3 py-2 transition-colors ${t?"bg-neutral-50 dark:bg-neutral-800/50":""}`,children:[e.jsxs("div",{className:"flex min-w-[200px] flex-1 items-center gap-2",children:[e.jsx(L,{id:`member-${r.id}`,checked:t,onCheckedChange:()=>I(r.id),disabled:d,className:"h-4 w-4 border-neutral-300 text-neutral-700 dark:border-neutral-700 dark:bg-neutral-800"}),e.jsx(p,{htmlFor:`member-${r.id}`,className:"cursor-pointer text-sm font-medium text-neutral-700 dark:text-neutral-300",children:r.name}),e.jsx("span",{className:"truncate text-xs text-gray-500 dark:text-gray-400",children:r.email})]}),n&&e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs("div",{className:"flex h-8 items-center overflow-hidden rounded-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-800",children:[e.jsx("span",{className:"flex h-full items-center border-r border-neutral-200 bg-neutral-50 px-2 text-xs whitespace-nowrap text-gray-500 dark:border-neutral-700 dark:bg-neutral-800/80 dark:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-3 w-3","aria-label":"Rate",children:e.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})}),e.jsx(P,{id:`rate-${r.id}`,type:"number",min:"0",step:"0.01",value:x,onChange:o=>{var T;const u={...a.team_member_rates},N=u[r.id]??{currency:r.currency??((T=m[0])==null?void 0:T.code)??"USD"};u[r.id]={...N,hourly_rate:o.target.value},l("team_member_rates",u)},className:"h-8 w-20 border-none text-sm tabular-nums focus-visible:ring-0 focus-visible:ring-offset-0",disabled:d})]}),e.jsxs("div",{className:"flex h-8 items-center overflow-hidden rounded-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-800",children:[e.jsx("span",{className:"flex h-full items-center border-r border-neutral-200 bg-neutral-50 px-2 text-xs whitespace-nowrap text-gray-500 dark:border-neutral-700 dark:bg-neutral-800/80 dark:text-gray-400",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-3 w-3","aria-label":"Currency",children:[e.jsx("circle",{cx:"12",cy:"12",r:"8"}),e.jsx("path",{d:"M9.5 9a2.5 2.5 0 0 1 5 0v6a2.5 2.5 0 0 1-5 0"})]})}),e.jsxs(G,{value:((i=a.team_member_rates[r.id])==null?void 0:i.currency)??r.currency??((M=m[0])==null?void 0:M.code)??"USD",onValueChange:o=>{const u={...a.team_member_rates},N=u[r.id]??{hourly_rate:x};u[r.id]={...N,currency:o},l("team_member_rates",u)},disabled:d,children:[e.jsx(J,{id:`currency-${r.id}`,className:"h-8 w-20 border-none pr-1 pl-2 text-sm focus:ring-0",children:e.jsx(K,{placeholder:"Currency"})}),e.jsx(Q,{className:"border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-800/50",children:(m&&m.length>0?m.map(o=>o.code):["USD"]).map(o=>e.jsx(X,{value:o,children:o},o))})]})]})]}),t&&!n&&e.jsx("div",{className:"ml-auto h-8"})]},r.id)})}):e.jsx("p",{className:"py-1 text-sm text-gray-500 dark:text-gray-400",children:"No team members available"})})]}),e.jsx(v,{message:f.team_members})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Project Approvers ",e.jsx("span",{className:"text-xs text-gray-500",children:"(optional)"})]}),e.jsxs("div",{className:"relative rounded-md border border-neutral-200 p-3 dark:border-neutral-700",children:[e.jsx("div",{className:"pointer-events-none absolute top-3 left-3",children:e.jsx(R,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})}),e.jsx("div",{className:"space-y-2 pl-7",children:a.team_members.length>0?j.filter(r=>a.team_members.includes(r.id)).map(r=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:`approver-${r.id}`,checked:a.approvers.includes(r.id),onCheckedChange:()=>E(r.id),disabled:d,className:"h-4 w-4 border-neutral-300 text-neutral-700 dark:border-neutral-700 dark:bg-neutral-800"}),e.jsxs(p,{htmlFor:`approver-${r.id}`,className:"cursor-pointer text-sm text-neutral-700 dark:text-neutral-300",children:[r.name," ",e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",r.email,")"]})]})]},`approver-${r.id}`)):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Select team members first"})})]}),e.jsx(v,{message:f.approvers})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3 border-t border-neutral-200 pt-6 dark:border-neutral-800",children:[e.jsx(q,{type:"button",variant:"outline",onClick:g,disabled:d,className:"border-neutral-200 hover:bg-neutral-100 hover:text-neutral-900 dark:border-neutral-800 dark:hover:bg-neutral-800 dark:hover:text-neutral-100",children:"Cancel"}),e.jsx(W,{tabIndex:3,loading:d,idleLabel:c?"Update Project":"Create Project",loadingLabel:c?"Updating...":"Creating...",idleIcon:c?e.jsx(U,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"}),loadingIcon:e.jsx(ie,{className:"h-4 w-4 animate-spin"}),className:"bg-gray-900 text-white hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600"})]})]})})]})})}export{Ve as default};
