import{c as ie,r as f,u as re,j as e,H as ne,b as le}from"./app-CE94QcfB.js";import{A as oe,a as ce,b as de,c as me,d as ue,e as xe,f as pe,g as he}from"./alert-dialog-Dv5S2ujf.js";import{t as q}from"./index-C5Svuudg.js";import{B as ge}from"./back-button-DPzgaXSY.js";import{I as d}from"./input-error-9xWteZf8.js";import{S as je}from"./submit-button-B_eWnsfJ.js";import{B}from"./button-CSc-Cw7e.js";import{C as N,a as b,b as S,c as E,d as C,e as fe}from"./card-BF0DTRGt.js";import{D as O,C as V}from"./react-datepicker-Cpw6gAu9.js";import{L as x,I as j}from"./label-DISzI683.js";import{S as w,a as D,b as I,c as T,d as o}from"./select-D_MCfbK8.js";import{S as R}from"./separator-Ypd1NZ1n.js";import{T as ve,a as _e,b as ye,c as v,d as Ne,e as be,f as _}from"./table-C7t7xskR.js";import{T as Se}from"./textarea-49cOPKwt.js";import{M as Ce}from"./master-layout-tsVhh441.js";import{H as we,c as De}from"./ClientController-Du4hdrfN.js";import{g as Ie}from"./InvoiceController-onzgdswi.js";import{F as Te}from"./file-text-D51RJe6F.js";import{U as Fe}from"./user-BD4_3ZDB.js";import{C as z}from"./calendar-C8zGel57.js";import{P as Q}from"./plus-CeOzYAGh.js";import{T as Ae}from"./trash-2-BRVXkUm4.js";import{L as $e}from"./loader-circle-D1ym3s0F.js";/* empty css            */import"./index-gOG35dkf.js";import"./index-Becnjq-x.js";import"./index-fJEy3cUu.js";import"./index-OH_msQzS.js";import"./index-DkUby8a3.js";import"./index-BC-ip4sp.js";import"./index-CSGd7LPk.js";import"./utils-DKW5XViW.js";import"./arrow-left-DJNiNUOf.js";import"./createLucideIcon-D9NWueAg.js";import"./floating-ui.react-dom-ODH34Sgt.js";import"./index-DmtIMq0f.js";import"./index-DwOlKDQm.js";import"./index-DssjTqXu.js";import"./chevron-up-BMiBX3If.js";import"./cookie-consent-CR7wTwap.js";import"./TaskController-DRILXs0Z.js";import"./jira-icon-pYe84P2s.js";import"./x-BKkU3iVo.js";import"./sheet-0Ok6l0ab.js";import"./clock-CV0oisNo.js";import"./appearance-dropdown-CplWtr1N.js";import"./dropdown-menu-Dy5Hq4rj.js";import"./index-C7hwMZoy.js";import"./circle-alert-5FNlBjr8.js";import"./checkbox-TCMWq4Ph.js";import"./badge-Do30HICq.js";import"./chevron-right-BzTA_0kR.js";import"./settings-Bjly2KGq.js";import"./bell-CbXQzXBs.js";import"./users-Dah8edja.js";import"./app-logo-icon-DHSG1eGj.js";import"./github-CZtBj8bQ.js";import"./log-out-BQwzfcg9.js";import"./building-BzSs3yfb.js";import"./projector-C9mKpjiA.js";import"./clipboard-list-BccoXVyt.js";import"./timer-BE1bBtuS.js";import"./square-check-big-B68kPrbC.js";const qe=[{title:"Invoices",href:"/invoice"},{title:"Create",href:"/invoice/create"}];function Vt(){const{auth:y}=ie().props,[W,Y]=f.useState([]),[h,J]=f.useState([]),[P,H]=f.useState(!0),K=()=>`INV-${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(Math.floor(Math.random()*1e4)).padStart(4,"0")}`,{data:a,setData:l,post:X,processing:n,errors:c,transform:M}=re({client_id:"",invoice_number:K(),issue_date:new Date,due_date:new Date(new Date().setDate(new Date().getDate()+30)),status:"draft",notes:"",discount_type:null,discount_value:"0",tax_type:null,tax_rate:"0",currency:y.user.currency?y.user.currency.toString():"USD",items:[{time_log_id:null,description:"",quantity:"1",unit_price:"0",amount:"0"}],grouped_time_log_ids:[]});f.useEffect(()=>{(async()=>{try{H(!0);const i=await De.data({});Y(i)}catch(i){console.error("Error fetching clients:",i),q.error("Failed to load clients")}finally{H(!1)}})().then()},[]),f.useEffect(()=>{(async()=>{var i;if(a.client_id)try{const s=await Ie.data({params:{client_id:a.client_id}});if(J(s),s.length>0){const r=(i=s[0])==null?void 0:i.currency;r?l("currency",r):y.user.currency?l("currency",y.user.currency?y.user.currency.toString():"USD"):l("currency","USD")}}catch(s){console.error("Error fetching time logs:",s),q.error("Failed to load time logs")}})().then()},[a.client_id]);const F=()=>a.items.reduce((t,i)=>t+parseFloat(i.amount||"0"),0),L=()=>{const t=F();if(!a.discount_type||parseFloat(a.discount_value)<=0)return 0;if(a.discount_type==="percentage")return t*parseFloat(a.discount_value)/100;if(a.discount_type==="fixed"){const i=parseFloat(a.discount_value);return i>t?t:i}return 0},U=()=>{const t=F(),i=L(),s=t-i;if(!a.tax_type||parseFloat(a.tax_rate)<=0)return 0;if(a.tax_type==="percentage")return s*parseFloat(a.tax_rate)/100;if(a.tax_type==="fixed"){const r=parseFloat(a.tax_rate);return r>s?s:r}return 0},Z=()=>{const t=F(),i=L(),s=U();return t-i+s},G=()=>{l("items",[...a.items,{time_log_id:null,description:"",quantity:"1",unit_price:"0",amount:"0"}])},ee=t=>{const i=[...a.items];i.splice(t,1),l("items",i)},A=(t,i,s)=>{const r=[...a.items];if(r[t]={...r[t],[i]:s.toString()},i==="quantity"||i==="unit_price"){const m=parseFloat(i==="quantity"?s.toString():r[t].quantity||"0"),p=parseFloat(i==="unit_price"?s.toString():r[t].unit_price||"0");r[t].amount=(m*p).toFixed(2)}l("items",r)},te=(t,i)=>{const s=[...a.items],r=typeof i=="object"&&Object.keys(i).length===0?"none":i;if(r==="none"){s[t]={...s[t],time_log_id:null,description:"",quantity:"1",unit_price:"0",amount:"0",group_project_id:void 0},l("items",s);return}if(r.startsWith("project-")){const p=parseInt(r.replace("project-","")),u=h.find(g=>g.project_id===p);if(u){const g=((u.total_hours||0)*(u.hourly_rate||0)).toFixed(2);s[t]={...s[t],time_log_id:null,description:`Time logged for ${u.project_name}`,quantity:u.total_hours.toString(),unit_price:u.hourly_rate.toString(),amount:g,group_project_id:p},l("items",s)}return}const m=i;s[t].group_project_id=void 0;for(const p of h){const u=p.time_logs.find(g=>g.id.toString()===m);if(u){const g=((u.duration||0)*(p.hourly_rate||0)).toFixed(2);s[t]={...s[t],time_log_id:m?m.toString():null,description:`Time logged for ${p.project_name}`,quantity:u.duration.toString(),unit_price:p.hourly_rate.toString(),amount:g},l("items",s);break}}},[se,k]=f.useState(!1),ae=()=>{const t=new Set;a.items.forEach(i=>{if(i.group_project_id){const s=h.find(r=>r.project_id===i.group_project_id);s&&s.time_logs&&s.time_logs.forEach(r=>t.add(r.id))}}),M(i=>({...i,grouped_time_log_ids:Array.from(t)})),X(route("invoice.store"),{onSuccess:()=>{q.success("Invoice created successfully"),le.visit(route("invoice.index")??"/invoice")},onError:()=>{q.error("Failed to create invoice")},onFinish:()=>{M(i=>i)}})},$=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:a.currency,currencyDisplay:"code"}).format(t);return e.jsxs(Ce,{breadcrumbs:qe,children:[e.jsx(ne,{title:"Create Invoice"}),e.jsxs("div",{className:"mx-auto flex flex-col gap-6 p-3",children:[e.jsxs("section",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-100",children:"Create Invoice"}),e.jsx("p",{className:"mt-1 text-gray-500 dark:text-gray-400",children:"Create a new invoice for a client"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(ge,{disabled:n})})]}),e.jsxs("form",{className:"flex flex-col gap-6",onSubmit:t=>{t.preventDefault(),k(!0)},children:[e.jsxs("h2",{className:"mt-2 flex items-center gap-2 border-b pb-2 text-xl font-semibold",children:[e.jsx(Te,{className:"h-5 w-5"}),"Invoice Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs(N,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(b,{children:[e.jsx(S,{className:"flex items-center gap-2 text-lg",children:"Basic Information"}),e.jsx(E,{children:"Enter the core details for your invoice"})]}),e.jsx(C,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"client_id",className:"flex items-center gap-1 text-sm font-medium",children:["Client ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsxs(w,{value:a.client_id,onValueChange:t=>l("client_id",t),disabled:n||P,children:[e.jsx(D,{id:"client_id",className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:P?"Loading clients...":"Select a client"})]})}),e.jsx(T,{children:W.map(t=>e.jsx(o,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(d,{message:c.client_id,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"invoice_number",className:"flex items-center gap-1 text-sm font-medium",children:["Invoice Number ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center",children:e.jsx(we,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(j,{id:"invoice_number",type:"text",required:!0,value:a.invoice_number,onChange:t=>l("invoice_number",t.target.value),disabled:n,placeholder:"Invoice number",className:"pl-10"})]}),e.jsx(d,{message:c.invoice_number,className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"issue_date",className:"flex items-center gap-1 text-sm font-medium",children:["Issue Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(O,{selected:a.issue_date,onChange:t=>l("issue_date",t),dateFormat:"yyyy-MM-dd",disabled:n,customInput:e.jsx(V,{id:"issue_date",icon:e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),placeholder:"Select issue date",value:a.issue_date?a.issue_date.toISOString().split("T")[0]:"",disabled:n})})}),e.jsx(d,{message:c.issue_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"due_date",className:"flex items-center gap-1 text-sm font-medium",children:["Due Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(O,{selected:a.due_date,onChange:t=>l("due_date",t),dateFormat:"yyyy-MM-dd",disabled:n,customInput:e.jsx(V,{id:"due_date",icon:e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),placeholder:"Select due date",value:a.due_date?a.due_date.toISOString().split("T")[0]:"",disabled:n})})}),e.jsx(d,{message:c.due_date,className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"status",className:"text-sm font-medium",children:"Status"}),e.jsx("div",{className:"relative",children:e.jsxs(w,{value:a.status,onValueChange:t=>l("status",t),disabled:!0,children:[e.jsx(D,{id:"status",className:"w-full",children:e.jsx(I,{placeholder:"Select status"})}),e.jsxs(T,{children:[e.jsx(o,{value:"draft",children:"Draft"}),e.jsx(o,{value:"sent",children:"Sent"}),e.jsx(o,{value:"paid",children:"Paid"}),e.jsx(o,{value:"partially_paid",children:"Partially Paid"}),e.jsx(o,{value:"overdue",children:"Overdue"}),e.jsx(o,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(d,{message:c.status,className:"mt-1"})]})]})})]}),e.jsxs(N,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(b,{children:[e.jsx(S,{className:"flex items-center gap-2 text-lg",children:"Additional Information"}),e.jsx(E,{children:"Add notes for this invoice"})]}),e.jsx(C,{children:e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"notes",className:"text-sm font-medium",children:["Notes ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsx(Se,{id:"notes",value:a.notes,onChange:t=>l("notes",t.target.value),disabled:n,placeholder:"Additional notes for the client",className:"min-h-[120px] resize-y"}),e.jsx(d,{message:c.notes,className:"mt-1"})]})})]})]}),e.jsxs(N,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-lg",children:"Invoice Items"}),e.jsx(E,{children:"Add the products or services you're invoicing for"})]}),e.jsxs(B,{type:"button",onClick:G,disabled:n,className:"flex items-center gap-2 bg-gray-900 text-sm hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",children:[e.jsx(Q,{className:"h-4 w-4"}),"Add Item"]})]}),e.jsx(C,{children:e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs(ve,{children:[e.jsx(_e,{className:"bg-muted/50",children:e.jsxs(ye,{children:[e.jsx(v,{children:"Time Log"}),e.jsx(v,{children:"Description"}),e.jsx(v,{children:"Quantity (hrs)"}),e.jsx(v,{children:"Unit Price"}),e.jsx(v,{children:"Amount"}),e.jsx(v,{className:"w-[50px]",children:void 0})]})}),e.jsx(Ne,{children:a.items.map((t,i)=>e.jsxs(be,{className:"hover:bg-muted/30",children:[e.jsxs(_,{children:[e.jsxs(w,{value:t.time_log_id||"none",onValueChange:s=>te(i,s),disabled:n,children:[e.jsx(D,{className:"w-full",children:e.jsx(I,{placeholder:"Select time log (optional)"})}),e.jsxs(T,{children:[e.jsx(o,{value:"none",children:"None"}),h.length>0&&e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-muted-foreground",children:"Project Totals"}),h.map((s,r)=>e.jsxs(o,{value:`project-${s.project_id}`,className:"font-medium",children:[s.project_name," - ",(s.total_hours||0).toFixed(2)," hours (",s.currency||"USD"," ",s.hourly_rate||0,"/hr)"]},`project-${s.project_id||`unnamed-${r}`}`)),h.length>0&&e.jsx("div",{className:"mt-2 px-2 py-1.5 text-xs font-medium text-muted-foreground",children:"Individual Time Logs"}),h.map((s,r)=>e.jsxs("div",{children:[s.time_logs&&s.time_logs.length>0&&e.jsx("div",{className:"px-2 py-1 text-xs font-medium",children:s.project_name}),s.time_logs&&s.time_logs.map(m=>e.jsxs(o,{value:m.id.toString(),className:"pl-4",children:[new Date(m.start_timestamp).toISOString().split("T")[0]," -"," ",(m.duration||0).toFixed(2)," hours"]},m.id))]},`logs-${s.project_id||`unnamed-${r}`}`))]})]}),e.jsx(d,{message:c[`items.${i}.time_log_id`],className:"mt-1"})]}),e.jsxs(_,{children:[e.jsx(j,{type:"text",value:t.description,onChange:s=>A(i,"description",s.target.value),disabled:n,placeholder:"Item description",required:!0}),e.jsx(d,{message:c[`items.${i}.description`],className:"mt-1"})]}),e.jsxs(_,{children:[e.jsx(j,{type:"number",min:"0.01",step:"0.01",value:t.quantity,onChange:s=>A(i,"quantity",s.target.value),disabled:n,required:!0}),e.jsx(d,{message:c[`items.${i}.quantity`],className:"mt-1"})]}),e.jsxs(_,{children:[e.jsx(j,{type:"number",min:"0",step:"0.01",value:t.unit_price,onChange:s=>A(i,"unit_price",s.target.value),disabled:n,required:!0}),e.jsx(d,{message:c[`items.${i}.unit_price`],className:"mt-1"})]}),e.jsxs(_,{children:[e.jsx(j,{type:"number",min:"0",step:"0.01",value:t.amount,onChange:s=>A(i,"amount",s.target.value),disabled:!0,required:!0,className:"bg-muted/40"}),e.jsx(d,{message:c[`items.${i}.amount`],className:"mt-1"})]}),e.jsx(_,{children:e.jsxs(B,{type:"button",variant:"ghost",size:"sm",disabled:n||a.items.length<=1,onClick:()=>ee(i),className:"h-8 w-8 bg-red-100 p-0 text-red-600 hover:bg-red-200",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Remove"})]})})]},i))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs(N,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsx(b,{children:e.jsx(S,{className:"flex items-center gap-2 text-lg",children:"Discount & Taxes"})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"discount_type",className:"text-sm font-medium",children:"Discount Type"}),e.jsxs(w,{value:a.discount_type||"none",onValueChange:t=>l("discount_type",t==="none"?null:t),disabled:n,children:[e.jsx(D,{id:"discount_type",className:"w-full",children:e.jsx(I,{placeholder:"No Discount"})}),e.jsxs(T,{children:[e.jsx(o,{value:"none",children:"No Discount"}),e.jsx(o,{value:"percentage",children:"Percentage (%)"}),e.jsx(o,{value:"fixed",children:"Fixed Amount"})]})]}),e.jsx(d,{message:c.discount_type,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"discount_value",className:"text-sm font-medium",children:a.discount_type==="percentage"?"Discount (%)":"Discount Amount"}),e.jsx(j,{id:"discount_value",type:"number",min:"0",step:a.discount_type==="percentage"?"1":"0.01",value:a.discount_value,onChange:t=>l("discount_value",t.target.value),disabled:n||!a.discount_type,placeholder:a.discount_type==="percentage"?"Enter percentage":"Enter amount"}),e.jsx(d,{message:c.discount_value,className:"mt-1"})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"tax_type",className:"text-sm font-medium",children:"Tax Type"}),e.jsxs(w,{value:a.tax_type||"none",onValueChange:t=>l("tax_type",t==="none"?null:t),disabled:n,children:[e.jsx(D,{id:"tax_type",className:"w-full",children:e.jsx(I,{placeholder:"No Tax"})}),e.jsxs(T,{children:[e.jsx(o,{value:"none",children:"No Tax"}),e.jsx(o,{value:"percentage",children:"Percentage (%)"}),e.jsx(o,{value:"fixed",children:"Fixed Amount"})]})]}),e.jsx(d,{message:c.tax_type,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"tax_rate",className:"text-sm font-medium",children:a.tax_type==="percentage"?"Tax (%)":"Tax Amount"}),e.jsx(j,{id:"tax_rate",type:"number",min:"0",step:"0.01",value:a.tax_rate,onChange:t=>l("tax_rate",t.target.value),disabled:n||!a.tax_type,placeholder:a.tax_type==="percentage"?"Enter percentage":"Enter amount"}),e.jsx(d,{message:c.tax_rate,className:"mt-1"})]})]})]})})]}),e.jsxs(N,{className:"overflow-hidden transition-all hover:shadow-md",children:[e.jsx(b,{children:e.jsx(S,{className:"text-lg",children:"Invoice Summary"})}),e.jsx(C,{children:e.jsxs("div",{className:"rounded-md border bg-muted/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:$(F())})]}),a.discount_type&&parseFloat(a.discount_value)>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-red-600 dark:text-red-400",children:[e.jsxs("span",{children:["Discount ",a.discount_type==="percentage"?`(${a.discount_value}%)`:"",":"]}),e.jsxs("span",{children:["-",$(L())]})]}),a.tax_type&&parseFloat(a.tax_rate)>0&&e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:["Tax ",a.tax_type==="percentage"?`(${a.tax_rate}%)`:"",":"]}),e.jsxs("span",{children:["+",$(U())]})]}),e.jsx(R,{className:"my-3"}),e.jsxs("div",{className:"flex items-center justify-between font-medium",children:[e.jsx("span",{className:"text-base",children:"Total:"}),e.jsx("span",{className:"text-base",children:$(Z())})]})]})}),e.jsx(fe,{className:"flex justify-end border-t p-4",children:e.jsx(je,{disabled:n,loading:n,idleLabel:"Create Invoice",loadingLabel:"Creating...",idleIcon:e.jsx(Q,{className:"h-4 w-4"}),loadingIcon:e.jsx($e,{className:"h-4 w-4 animate-spin"}),className:"bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600"})})]})]})]})]}),e.jsx(oe,{open:se,onOpenChange:k,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"Create invoice?"}),e.jsx(ue,{children:"This will create the invoice with the current details and associate selected time logs."})]}),e.jsxs(xe,{children:[e.jsx(pe,{disabled:n,children:"Cancel"}),e.jsx(he,{onClick:()=>{k(!1),ae()},disabled:n,children:"Confirm"})]})]})})]})}export{Vt as default};
