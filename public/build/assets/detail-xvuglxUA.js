import{c as J,r as d,f as Q,u as V,j as e,H as W,b as H}from"./app-CE94QcfB.js";import{B as Z}from"./back-button-DPzgaXSY.js";import{A as ee,a as se,b as re,c as te,d as ie,e as ae,f as ne,g as de}from"./alert-dialog-Dv5S2ujf.js";import{B as n}from"./badge-Do30HICq.js";import{B as oe}from"./button-CSc-Cw7e.js";import{C as le,a as ce,b as me,c as pe,d as xe}from"./card-BF0DTRGt.js";import{R as M}from"./rich-text-editor-bUsVxFlH.js";import{M as ue}from"./master-layout-tsVhh441.js";import{p as O}from"./purify.es-CEVJ7K31.js";import{I as he}from"./info-Im89IFst.js";import{C as ge}from"./calendar-C8zGel57.js";import{E as je}from"./external-link-CXzUVR5e.js";import{S as fe}from"./save-B95-0usG.js";import{X as be}from"./x-BKkU3iVo.js";import{P as Ne,T as ye}from"./trash-uMJ2IdmR.js";import{T as ve}from"./trash-2-BRVXkUm4.js";/* empty css            */import"./utils-DKW5XViW.js";import"./arrow-left-DJNiNUOf.js";import"./createLucideIcon-D9NWueAg.js";import"./index-gOG35dkf.js";import"./index-Becnjq-x.js";import"./index-fJEy3cUu.js";import"./index-OH_msQzS.js";import"./index-DkUby8a3.js";import"./index-BC-ip4sp.js";import"./index-CSGd7LPk.js";import"./list-BjNAZPQN.js";import"./cookie-consent-CR7wTwap.js";import"./index-DmtIMq0f.js";import"./floating-ui.react-dom-ODH34Sgt.js";import"./index-DwOlKDQm.js";import"./select-D_MCfbK8.js";import"./index-DssjTqXu.js";import"./chevron-up-BMiBX3If.js";import"./TaskController-DRILXs0Z.js";import"./jira-icon-pYe84P2s.js";import"./loader-circle-D1ym3s0F.js";import"./sheet-0Ok6l0ab.js";import"./plus-CeOzYAGh.js";import"./clock-CV0oisNo.js";import"./appearance-dropdown-CplWtr1N.js";import"./dropdown-menu-Dy5Hq4rj.js";import"./index-C7hwMZoy.js";import"./circle-alert-5FNlBjr8.js";import"./checkbox-TCMWq4Ph.js";import"./label-DISzI683.js";import"./index-C5Svuudg.js";import"./chevron-right-BzTA_0kR.js";import"./settings-Bjly2KGq.js";import"./bell-CbXQzXBs.js";import"./users-Dah8edja.js";import"./app-logo-icon-DHSG1eGj.js";import"./github-CZtBj8bQ.js";import"./log-out-BQwzfcg9.js";import"./building-BzSs3yfb.js";import"./projector-C9mKpjiA.js";import"./clipboard-list-BccoXVyt.js";import"./timer-BE1bBtuS.js";import"./file-text-D51RJe6F.js";import"./square-check-big-B68kPrbC.js";const we=[{title:"Tasks",href:"/task"}];function Is({task:r,attachments:p=[],mentionableUsers:b=[]}){var D,S,_,T,A,B,I;const $=({html:s})=>{const t=typeof window<"u"?O.sanitize(s):s;return e.jsx("div",{dangerouslySetInnerHTML:{__html:t}})},{auth:o}=J().props,[x,N]=d.useState(Array.isArray(r.comments)?r.comments:[]),y=o.user.id,[P,l]=d.useState(!1),[v,u]=d.useState(null),[w,h]=d.useState(null);Q(`App.Models.User.${o.user.id}`,"TaskCommented",s=>{var t;try{if(!s||!s.task||s.task.id!==r.id)return;const i=(t=s.comment)==null?void 0:t.id;if(typeof i!="number")return;N(a=>{var E,F,z;if(a.some(G=>G.id===i))return a;const f={id:i,body:((E=s.comment)==null?void 0:E.body)??"",user:{id:(F=s.commenter)==null?void 0:F.id,name:(z=s.commenter)==null?void 0:z.name},created_at:new Date().toISOString()};return[...a,f]})}catch{}});const[g,c]=d.useState(""),j=s=>s.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim(),R=()=>{v!=null&&H.delete(route("task.comments.destroy",{task:r.id,comment:v}),{preserveScroll:!0,onFinish:()=>{l(!1),u(null)}})},k=`${r.title} · Task Details`,{data:m,setData:L,post:U,reset:K}=V({body:""}),X=s=>{if(s.preventDefault(),!j(m.body))return;const t=m.body;U(route("task.comments.store",{task:r.id}),{preserveScroll:!0,onSuccess:()=>{N(i=>[...i,{id:Date.now(),body:t,user:{id:o.user.id,name:o.user.name},created_at:new Date().toISOString()}]),K("body")},onError:()=>{}})},Y=s=>{switch(s){case"high":return e.jsx(n,{variant:"destructive",className:"capitalize",children:s});case"medium":return e.jsx(n,{variant:"default",className:"capitalize",children:s});case"low":return e.jsx(n,{variant:"outline",className:"capitalize",children:s})}},q=s=>{switch(s){case"completed":return e.jsx(n,{variant:"success",className:"capitalize",children:s.replace("_"," ")});case"in_progress":return e.jsx(n,{variant:"warning",className:"capitalize",children:s.replace("_"," ")});case"pending":return e.jsx(n,{variant:"secondary",className:"capitalize",children:s.replace("_"," ")})}},C=s=>{if(!s)return"";const t=new Date(s),i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),f=String(t.getDate()).padStart(2,"0");return`${i}-${a}-${f}`};return e.jsxs(ue,{breadcrumbs:[...we,{title:"Details",href:`/task/${r.id}`}],children:[e.jsx(W,{title:k}),e.jsxs("div",{className:"mx-auto max-w-4xl space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(Z,{})}),e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(me,{className:"text-2xl font-bold tracking-tight",children:r.title}),e.jsxs(pe,{className:"mt-2 flex flex-wrap items-center gap-2 text-sm",children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-primary"})," ",r.project.name]}),e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsx("span",{className:"inline-flex items-center gap-2",children:q(r.status)}),e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsx("span",{className:"inline-flex items-center gap-2",children:Y(r.priority)}),r.due_date&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden text-muted-foreground md:inline",children:"•"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}),"Due ",C(r.due_date)]})]})]})]}),r.assignees&&r.assignees.length>0&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-4 rounded-lg bg-muted/40",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:r.assignees.map(s=>e.jsx("span",{className:"flex items-center gap-2 bg-background px-3 py-1 shadow-sm",children:e.jsx("span",{className:"text-sm",children:s.name})},s.id))})})}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-4 rounded-lg bg-muted/40",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(s=>e.jsx(n,{style:{backgroundColor:s.color,color:"#fff"},children:s.name},s.id))})})})]})}),e.jsxs(xe,{children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-4 rounded-lg bg-muted/40 p-4",children:r.description?e.jsx("div",{className:"text-base",children:e.jsx($,{html:r.description})}):e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-dashed bg-background/50 p-3 text-sm text-muted-foreground",children:[e.jsx("span",{children:"No description provided"}),e.jsx("span",{className:"hidden md:inline",children:"— add one from the edit page"})]})})}),((D=r.meta)==null?void 0:D.source_url)&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-4 bg-muted/40 p-4",children:e.jsx("div",{className:"space-y-2",children:(((S=r.meta)==null?void 0:S.source)||((_=r.meta)==null?void 0:_.source_number))&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[((T=r.meta)==null?void 0:T.source)&&e.jsx("span",{className:"font-medium text-foreground",children:r.meta.source}),((A=r.meta)==null?void 0:A.source)&&((B=r.meta)==null?void 0:B.source_number)&&e.jsx("span",{className:"mx-1",children:"•"}),((I=r.meta)==null?void 0:I.source_number)&&e.jsxs("span",{children:["#",r.meta.source_number]}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsx("a",{href:r.meta.source_url,target:"_blank",rel:"noreferrer",className:"inline-flex items-center text-primary hover:underline",children:e.jsx(je,{className:"h-4 w-4"})})]})})})}),p&&p.length>0&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-4 bg-muted/40 p-4",children:e.jsx("ul",{className:"divide-y",children:p.map(s=>e.jsx("li",{className:"flex items-center justify-between gap-3 p-3 text-sm",children:e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"truncate text-blue-600 hover:underline dark:text-blue-400",children:s.name}),e.jsxs("span",{className:"shrink-0 text-xs text-muted-foreground",children:[(s.size/1024).toFixed(1)," KB"]})]})},s.name))})})})]}),e.jsx("div",{className:"mt-6 space-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 rounded-lg border bg-muted/40 p-4",children:[e.jsx("div",{className:"space-y-4",children:x&&x.length>0?x.map(s=>{var t,i;return e.jsxs("div",{className:"rounded-md bg-background p-3 shadow-sm",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:((t=s.user)==null?void 0:t.name)??"User"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:C(s.created_at)}),(y===r.project.user_id||y===(((i=s.user)==null?void 0:i.id)??-1))&&e.jsx(e.Fragment,{children:w===s.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",title:"Save comment",className:"cursor-pointer text-green-600 hover:text-green-700",onClick:()=>{j(g)&&H.put(route("task.comments.update",{task:r.id,comment:s.id}),{body:g},{preserveScroll:!0,onFinish:()=>{h(null),c("")}})},children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",title:"Cancel edit",className:"cursor-pointer text-muted-foreground hover:text-foreground",onClick:()=>{h(null),c("")},children:e.jsx(be,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",title:"Edit comment",className:"cursor-pointer text-blue-600 hover:text-blue-700",onClick:()=>{h(s.id),c(s.body)},children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",title:"Delete comment",className:"cursor-pointer text-red-500 hover:text-red-600",onClick:()=>{u(s.id),l(!0)},children:e.jsx(ye,{className:"h-4 w-4"})})]})})]})]}),w===s.id?e.jsx(M,{value:g,onChange:a=>c(a),placeholder:"Edit comment...",minRows:4,mentions:b}):e.jsx("div",{className:"prose prose-sm dark:prose-invert mt-4 max-w-none text-sm",dangerouslySetInnerHTML:{__html:typeof window<"u"?O.sanitize(s.body||""):s.body||""}})]},s.id)}):e.jsx("div",{className:"rounded-md border border-dashed bg-background/50 p-3 text-sm text-muted-foreground",children:"No comments yet"})}),e.jsx("form",{onSubmit:X,className:"mt-2",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(M,{value:m.body,onChange:s=>L("body",s),placeholder:"Add a comment...",minRows:4,mentions:b}),e.jsx("div",{className:"flex justify-end",children:e.jsx(oe,{type:"submit",disabled:!j(m.body),className:"flex items-center gap-2 bg-gray-900 text-sm hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Post Comment"})})]})})]})})]})]})]}),e.jsx(ee,{open:P,onOpenChange:s=>{l(s),s||u(null)},children:e.jsxs(se,{children:[e.jsxs(re,{children:[e.jsx(te,{children:"Are you sure you want to delete this comment?"}),e.jsx(ie,{children:"Once the comment is deleted, it will be permanently removed. This action cannot be undone."})]}),e.jsxs(ae,{children:[e.jsx(ne,{onClick:()=>l(!1),children:"Cancel"}),e.jsxs(de,{onClick:R,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Delete Comment"]})]})]})})]})}export{Is as default};
