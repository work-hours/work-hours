import{u as O,r as w,j as e}from"./app-CE94QcfB.js";import{I as c}from"./input-error-9xWteZf8.js";import{S as B}from"./submit-button-B_eWnsfJ.js";import{B as Y}from"./button-CSc-Cw7e.js";import{C as q}from"./checkbox-TCMWq4Ph.js";import{D as f,C as b}from"./react-datepicker-Cpw6gAu9.js";import{L as d,I as A}from"./label-DISzI683.js";import{S as N}from"./searchable-select-BHMLfEm8.js";import{S as P,a as U,b as R,c as W,d as z}from"./sheet-0Ok6l0ab.js";import{T as G}from"./tag-input-BA2zQwVE.js";import{t as p}from"./index-C5Svuudg.js";import{C as x}from"./clock-CV0oisNo.js";import{B as J}from"./briefcase-BmAm87Tp.js";import{C as K}from"./clipboard-list-BccoXVyt.js";import{T as Q}from"./timer-BE1bBtuS.js";import{L as V}from"./loader-circle-D1ym3s0F.js";import{S as X}from"./save-B95-0usG.js";/* empty css            */import"./utils-DKW5XViW.js";import"./index-Becnjq-x.js";import"./index-gOG35dkf.js";import"./index-DssjTqXu.js";import"./createLucideIcon-D9NWueAg.js";import"./index-DwOlKDQm.js";import"./index-CSGd7LPk.js";import"./index-DkUby8a3.js";import"./index-BC-ip4sp.js";import"./floating-ui.react-dom-ODH34Sgt.js";import"./select-D_MCfbK8.js";import"./index-DmtIMq0f.js";import"./index-OH_msQzS.js";import"./chevron-up-BMiBX3If.js";import"./users-Dah8edja.js";import"./index-fJEy3cUu.js";import"./x-BKkU3iVo.js";import"./badge-Do30HICq.js";function Ee({open:h,mode:_,onClose:g,projects:v,tasks:y,timeLog:r}){const i=_==="edit",{data:a,setData:n,post:S,put:D,processing:l,errors:m,reset:T}=O({project_id:i&&r?r.project_id:null,task_id:i&&r?r.task_id:null,start_timestamp:i&&r?new Date(r.start_timestamp).toISOString():new Date().toISOString(),end_timestamp:i&&r&&r.end_timestamp?new Date(r.end_timestamp).toISOString():"",note:i&&r?r.note:"",non_billable:i&&r?!!r.non_billable:!1,mark_task_complete:!1,close_github_issue:!1,mark_jira_done:!1,tags:i&&r?r.tags||[]:[]});w.useEffect(()=>{if(!h){T();return}n(i&&r?{project_id:r.project_id,task_id:r.task_id,start_timestamp:new Date(r.start_timestamp).toISOString(),end_timestamp:r.end_timestamp?new Date(r.end_timestamp).toISOString():"",note:r.note,non_billable:!!r.non_billable,mark_task_complete:!1,close_github_issue:!1,mark_jira_done:!1,tags:r.tags||[]}:{project_id:null,task_id:null,start_timestamp:new Date().toISOString(),end_timestamp:"",note:"",non_billable:!1,mark_task_complete:!1,close_github_issue:!1,mark_jira_done:!1,tags:[]})},[h,_,r]);const k=a.start_timestamp?new Date(a.start_timestamp):new Date,I=a.end_timestamp?new Date(a.end_timestamp):null,j=w.useMemo(()=>{if(!a.start_timestamp||!a.end_timestamp)return null;const t=new Date(a.start_timestamp),u=(new Date(a.end_timestamp).getTime()-t.getTime())/(1e3*60*60);return Math.round(u*100)/100},[a.start_timestamp,a.end_timestamp]),C=t=>{if(t){const s=new Date(a.start_timestamp),o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),s.getHours(),s.getMinutes());if(n("start_timestamp",o.toISOString()),a.end_timestamp){const u=new Date(a.end_timestamp),H=new Date(t.getFullYear(),t.getMonth(),t.getDate(),u.getHours(),u.getMinutes());n("end_timestamp",H.toISOString())}}},F=t=>{if(t){const s=new Date(a.start_timestamp),o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),t.getHours(),t.getMinutes());n("start_timestamp",o.toISOString()),a.end_timestamp&&new Date(a.end_timestamp).getTime()<=o.getTime()&&n("end_timestamp","")}},M=t=>{if(t){const s=new Date(a.start_timestamp),o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),t.getHours(),t.getMinutes());n("end_timestamp",o.toISOString())}else n("end_timestamp","")},E=t=>{t.preventDefault(),i&&r?D(route("time-log.update",r.id),{onSuccess:()=>{window.dispatchEvent(new Event("refresh-time-logs")),p.success("Time log updated successfully"),g()},onError:()=>p.error("Failed to update time log"),preserveScroll:!0}):S(route("time-log.store"),{onSuccess:()=>{window.dispatchEvent(new Event("refresh-time-logs")),p.success("Time log created successfully"),g()},onError:()=>p.error("Failed to create time log"),preserveScroll:!0})};return e.jsx(P,{open:h,onOpenChange:t=>!t&&g(),children:e.jsxs(U,{side:"right",className:"bg-white pr-6 pb-8 pl-6 sm:max-w-md md:max-w-lg dark:bg-neutral-900",children:[e.jsxs(R,{className:"",children:[e.jsx(W,{className:"flex items-center gap-2 text-xl text-neutral-900 dark:text-white",children:i?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"h-5 w-5 text-neutral-700 dark:text-neutral-300"})," Edit Time Log"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"h-5 w-5 text-neutral-700 dark:text-neutral-300"})," Add Time Log"]})}),e.jsx(z,{className:"text-sm text-neutral-500 dark:text-neutral-400",children:i?"Update your time entry":"Create a new time entry"})]}),e.jsx("div",{children:e.jsx("form",{className:"flex flex-col gap-8",onSubmit:E,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Project Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"project_id",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Project"}),e.jsx("div",{className:"relative",children:e.jsx(N,{id:"project_id",value:a.project_id!==null?String(a.project_id):"",onChange:t=>{n("project_id",parseInt(t)),n("task_id",null)},options:v,placeholder:"Select a project",disabled:l,icon:e.jsx(J,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),className:"border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})}),e.jsx(c,{message:m.project_id,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"task_id",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Task (Optional)"}),e.jsx("div",{className:"relative",children:e.jsx(N,{id:"task_id",value:a.task_id===null?"":String(a.task_id),onChange:t=>n("task_id",t?parseInt(t):null),options:y.filter(t=>t.project_id===(a.project_id??-1)).map(t=>({id:t.id,name:t.title})),placeholder:"Select a task (optional)",disabled:l||a.project_id===null,icon:e.jsx(K,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),className:"border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})}),e.jsx(c,{message:m.task_id,className:"mt-1"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Time Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"log_date",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Date"}),e.jsx(f,{selected:k,onChange:C,dateFormat:"yyyy-MM-dd",required:!0,disabled:l,customInput:e.jsx(b,{id:"log_date",icon:e.jsx(x,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),required:!0,disabled:l,className:"h-10 w-full border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})}),e.jsx(c,{message:m.start_timestamp,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"start_time",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Start Time"}),e.jsx(f,{selected:k,onChange:F,showTimeSelect:!0,showTimeSelectOnly:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"HH:mm",required:!0,disabled:l,customInput:e.jsx(b,{id:"start_time",icon:e.jsx(x,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),required:!0,disabled:l,className:"h-10 w-full border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"end_time",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"End Time"}),e.jsx(f,{selected:I,onChange:M,showTimeSelect:!0,showTimeSelectOnly:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"HH:mm",disabled:l,isClearable:!0,placeholderText:"Select end time (optional)",filterDate:t=>{const s=new Date(a.start_timestamp);return t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()},filterTime:t=>{const s=new Date(a.start_timestamp);return new Date(s.getFullYear(),s.getMonth(),s.getDate(),t.getHours(),t.getMinutes()).getTime()>s.getTime()},customInput:e.jsx(b,{id:"end_time",icon:e.jsx(Q,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),disabled:l,className:"h-10 w-full border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"})}),e.jsx(c,{message:m.end_timestamp})]})]}),j!==null?e.jsxs("p",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:["Duration: ",j," hours"]}):e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Leave end time empty if you're still working"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Additional Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"note",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:["Note ",a.task_id?"(Optional)":""]}),e.jsx(A,{id:"note",value:a.note,onChange:t=>n("note",t.target.value),required:!a.task_id,disabled:l,placeholder:"What did you work on?",className:"h-10 border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"}),e.jsx(c,{message:m.note,className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center space-x-2 rounded-md border border-neutral-100 bg-neutral-50 p-3 dark:border-neutral-800 dark:bg-neutral-800/30",children:[e.jsx("div",{className:"flex h-5 items-center",children:e.jsx(q,{id:"non_billable",checked:a.non_billable,onCheckedChange:t=>n("non_billable",t),className:"border-neutral-300 text-neutral-700 dark:border-neutral-700 dark:bg-neutral-800"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(d,{htmlFor:"non_billable",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mark as non-billable"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This time won't be included in payment calculations"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"tags",className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Tags"}),e.jsx(G,{value:a.tags,onChange:t=>n("tags",t),placeholder:"Add tags (press enter to add)",className:"border-neutral-200 bg-white ring-offset-white focus-visible:ring-neutral-400 dark:border-neutral-800 dark:bg-neutral-800/50 dark:ring-offset-neutral-900 dark:focus-visible:ring-neutral-600"}),e.jsx(c,{message:m.tags,className:"mt-1"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3 border-t border-neutral-200 pt-6 dark:border-neutral-800",children:[e.jsx(Y,{type:"button",variant:"outline",onClick:g,disabled:l,className:"border-neutral-200 hover:bg-neutral-100 hover:text-neutral-900 dark:border-neutral-800 dark:hover:bg-neutral-800 dark:hover:text-neutral-100",children:"Cancel"}),e.jsx(B,{loading:l,idleLabel:i?"Update Time Log":"Save Time Log",loadingLabel:i?"Updating...":"Saving...",idleIcon:e.jsx(X,{className:"h-4 w-4"}),loadingIcon:e.jsx(V,{className:"h-4 w-4 animate-spin"}),className:"bg-gray-900 text-white hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600"})]})]})})})]})})}export{Ee as default};
